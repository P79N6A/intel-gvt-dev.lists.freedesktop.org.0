Delivered-To: linux.kernel.mailinglists@gmail.com
Received: by 2002:a81:3684:0:0:0:0:0 with SMTP id d126csp3076530ywa;
        Tue, 19 Feb 2019 00:52:34 -0800 (PST)
X-Google-Smtp-Source: AHgI3IZrD7KuvDmHeaSvFX7aFz5OctAovLObA1csqWPeCtZG7w4oYuXCn080LE1KEYY1xeqGAzyX
X-Received: by 2002:a17:902:bd97:: with SMTP id q23mr13149002pls.210.1550566354282;
        Tue, 19 Feb 2019 00:52:34 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1550566354; cv=none;
        d=google.com; s=arc-20160816;
        b=NmCWplwxJiA8yuyQxVW0WaXlyH18RpPIaAUjMZ7ptekH2WSpdRxt35Dxiz2z0/6svJ
         faySRVF+BWFGlfSH8Xx8J22Ru06GjpV2HzOwQu5qzXxeLq85oHFVI5TG5HPJ3hwakoPY
         NvdLeAtGFzKCdQP6susff94xAoais5e9Eqt1K4P7xfCmuREVe9iy2UcnKJaq5TPW3rU4
         gEGq9QD2+b66UQ3f7dcN0+wD5gwxp9LZap24ePmQ62B0cbHfQ595La1c4tW+UYXsgDE5
         RL277NBFDiAusz/224wxJ/o8o8fQVgjt5xxSyzc1vrPJT1VSMtyhui6sJIg+t1c/HlIm
         kFdQ==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=sender:errors-to:content-transfer-encoding:mime-version:cc
         :list-subscribe:list-help:list-post:list-archive:list-unsubscribe
         :list-id:precedence:references:in-reply-to:message-id:date:subject
         :to:from:delivered-to;
        bh=gnFEjrT1+nASRmDWh5UP9q06yLMQyg9v9H+7ZMEkWjU=;
        b=yvfga0gIfaYCaTD1BVeAHjam/TtZcv97815Jg1WQNwTIaPbInobaXK2TSqs4lxT7wr
         hyA56KlRbTGuLrWSpTVhTNorIDHqBj6ib6vZBJqifUspUPQpdZom0njdOfZlD409bHgI
         OM8/PHn8ieRrKmh+cd7yyJRysepLO6vno6eVmFSVM64q6sM+NsR9Be2Yo0mZnufuXeBZ
         9QbFPzLwfvhrqom9i448XwPaO2z8gd6JT6xDar2gZrNdyQoeaIt7QAiAr7vEiDFpPWL4
         jH4V763CJuTa9lnYvJ2zkR7ZA+jbrP0KUyNpGJp3M8+PDPHL3VnSgSyb1mvlGXv/X/Z8
         2eJQ==
ARC-Authentication-Results: i=1; mx.google.com;
       spf=pass (google.com: best guess record for domain of intel-gvt-dev-bounces@lists.freedesktop.org designates 2610:10:20:722:a800:ff:fe36:1795 as permitted sender) smtp.mailfrom=intel-gvt-dev-bounces@lists.freedesktop.org;
       dmarc=fail (p=NONE sp=NONE dis=NONE) header.from=intel.com
Return-Path: <intel-gvt-dev-bounces@lists.freedesktop.org>
Received: from gabe.freedesktop.org (gabe.freedesktop.org. [2610:10:20:722:a800:ff:fe36:1795])
        by mx.google.com with ESMTPS id c142si15686784pfb.33.2019.02.19.00.52.34
        (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
        Tue, 19 Feb 2019 00:52:34 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of intel-gvt-dev-bounces@lists.freedesktop.org designates 2610:10:20:722:a800:ff:fe36:1795 as permitted sender) client-ip=2610:10:20:722:a800:ff:fe36:1795;
Authentication-Results: mx.google.com;
       spf=pass (google.com: best guess record for domain of intel-gvt-dev-bounces@lists.freedesktop.org designates 2610:10:20:722:a800:ff:fe36:1795 as permitted sender) smtp.mailfrom=intel-gvt-dev-bounces@lists.freedesktop.org;
       dmarc=fail (p=NONE sp=NONE dis=NONE) header.from=intel.com
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E25B888F3A;
	Tue, 19 Feb 2019 08:52:33 +0000 (UTC)
X-Original-To: intel-gvt-dev@lists.freedesktop.org
Delivered-To: intel-gvt-dev@lists.freedesktop.org
Received: from mga12.intel.com (mga12.intel.com [192.55.52.136])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EFFD788F3A
 for <intel-gvt-dev@lists.freedesktop.org>;
 Tue, 19 Feb 2019 08:52:32 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga002.fm.intel.com ([10.253.24.26])
 by fmsmga106.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 19 Feb 2019 00:52:32 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.58,387,1544515200"; d="scan'208";a="144637067"
Received: from joy-desktop.sh.intel.com ([10.239.13.17])
 by fmsmga002.fm.intel.com with ESMTP; 19 Feb 2019 00:52:28 -0800
From: Yan Zhao <yan.y.zhao@intel.com>
To: alex.williamson@redhat.com,
	qemu-devel@nongnu.org
Subject: [PATCH 2/5] vfio/migration: support device of device config capability
Date: Tue, 19 Feb 2019 16:52:27 +0800
Message-Id: <1550566347-3648-1-git-send-email-yan.y.zhao@intel.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1550566254-3545-1-git-send-email-yan.y.zhao@intel.com>
References: <1550566254-3545-1-git-send-email-yan.y.zhao@intel.com>
X-BeenThere: intel-gvt-dev@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: "Intel GVT \(Graphics Virtualization\) development list"
 <intel-gvt-dev.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gvt-dev>
List-Post: <mailto:intel-gvt-dev@lists.freedesktop.org>
List-Help: <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=subscribe>
Cc: cjia@nvidia.com, kvm@vger.kernel.org, aik@ozlabs.ru,
 Zhengxiao.zx@Alibaba-inc.com, shuangtai.tst@alibaba-inc.com,
 kwankhede@nvidia.com, eauger@redhat.com, yi.l.liu@intel.com,
 eskultet@redhat.com, ziye.yang@intel.com, mlevitsk@redhat.com,
 pasic@linux.ibm.com, arei.gonglei@huawei.com, felipe@nutanix.com,
 Ken.Xue@amd.com, kevin.tian@intel.com, Yan Zhao <yan.y.zhao@intel.com>,
 dgilbert@redhat.com, intel-gvt-dev@lists.freedesktop.org,
 changpeng.liu@intel.com, cohuck@redhat.com, zhi.a.wang@intel.com,
 jonathan.davies@nutanix.com
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gvt-dev-bounces@lists.freedesktop.org
Sender: "intel-gvt-dev" <intel-gvt-dev-bounces@lists.freedesktop.org>

RGV2aWNlIGNvbmZpZyBpcyB0aGUgZGVmYXVsdCBkYXRhIHRoYXQgZXZlcnkgZGV2aWNlIHNob3Vs
ZCBoYXZlLiBzbwpkZXZpY2UgY29uZmlnIGNhcGFiaWxpdHkgaXMgYnkgZGVmYXVsdCBvbiwgbm8g
bmVlZCB0byBzZXQuCgotIEN1cnJlbnRseSB0d28gdHlwZSBvZiByZXNvdXJjZXMgYXJlIHNhdmVk
L2xvYWRlZCBmb3IgZGV2aWNlIG9mIGRldmljZQogIGNvbmZpZyBjYXBhYmlsaXR5OgogIEdlbmVy
YWwgUENJIGNvbmZpZyBkYXRhLCBhbmQgRGV2aWNlIGNvbmZpZyBkYXRhLgogIFRoZXkgYXJlIGNv
cGllcyBhcyBhIHdob2xlIHdoZW4gcHJlY29weSBpcyBzdG9wcGVkLgoKTWlncmF0aW9uIHNldHVw
IGZsb3c6Ci0gU2V0dXAgZGV2aWNlIHN0YXRlIHJlZ2lvbnMsIGNoZWNrIGl0cyBkZXZpY2Ugc3Rh
dGUgdmVyc2lvbiBhbmQgY2FwYWJpbGl0aWVzLgogIE1tYXAgRGV2aWNlIENvbmZpZyBSZWdpb24g
YW5kIERpcnR5IEJpdG1hcCBSZWdpb24sIGlmIGF2YWlsYWJsZS4KLSBJZiBkZXZpY2Ugc3RhdGUg
cmVnaW9ucyBhcmUgZmFpbGVkIHRvIGdldCBzZXR1cCwgYSBtaWdyYXRpb24gYmxvY2tlciBpcwog
IHJlZ2lzdGVyZWQgaW5zdGVhZC4KLSBBZGRlZCBTYXZlVk1IYW5kbGVycyB0byByZWdpc3RlciBk
ZXZpY2Ugc3RhdGUgc2F2ZS9sb2FkIGhhbmRsZXJzLgotIFJlZ2lzdGVyIFZNIHN0YXRlIGNoYW5n
ZSBoYW5kbGVyIHRvIHNldCBkZXZpY2UncyBydW5uaW5nL3N0b3Agc3RhdGVzLgotIE9uIG1pZ3Jh
dGlvbiBzdGFydHVwIG9uIHNvdXJjZSBtYWNoaW5lLCBzZXQgZGV2aWNlJ3Mgc3RhdGUgdG8KICBW
RklPX0RFVklDRV9TVEFURV9MT0dHSU5HCgpTaWduZWQtb2ZmLWJ5OiBZYW4gWmhhbyA8eWFuLnku
emhhb0BpbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IFl1bGVpIFpoYW5nIDx5dWxlaS56aGFuZ0Bp
bnRlbC5jb20+Ci0tLQogaHcvdmZpby9NYWtlZmlsZS5vYmpzICAgICAgICAgfCAgIDIgKy0KIGh3
L3ZmaW8vbWlncmF0aW9uLmMgICAgICAgICAgIHwgNjMzICsrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKwogaHcvdmZpby9wY2kuYyAgICAgICAgICAgICAgICAgfCAgIDEg
LQogaHcvdmZpby9wY2kuaCAgICAgICAgICAgICAgICAgfCAgMjUgKy0KIGluY2x1ZGUvaHcvdmZp
by92ZmlvLWNvbW1vbi5oIHwgICAxICsKIDUgZmlsZXMgY2hhbmdlZCwgNjU5IGluc2VydGlvbnMo
KyksIDMgZGVsZXRpb25zKC0pCiBjcmVhdGUgbW9kZSAxMDA2NDQgaHcvdmZpby9taWdyYXRpb24u
YwoKZGlmZiAtLWdpdCBhL2h3L3ZmaW8vTWFrZWZpbGUub2JqcyBiL2h3L3ZmaW8vTWFrZWZpbGUu
b2JqcwppbmRleCA4YjNmNjY0Li5mMzJmZjE5IDEwMDY0NAotLS0gYS9ody92ZmlvL01ha2VmaWxl
Lm9ianMKKysrIGIvaHcvdmZpby9NYWtlZmlsZS5vYmpzCkBAIC0xLDYgKzEsNiBAQAogaWZlcSAo
JChDT05GSUdfTElOVVgpLCB5KQogb2JqLSQoQ09ORklHX1NPRlRNTVUpICs9IGNvbW1vbi5vCi1v
YmotJChDT05GSUdfUENJKSArPSBwY2kubyBwY2ktcXVpcmtzLm8gZGlzcGxheS5vCitvYmotJChD
T05GSUdfUENJKSArPSBwY2kubyBwY2ktcXVpcmtzLm8gZGlzcGxheS5vIG1pZ3JhdGlvbi5vCiBv
YmotJChDT05GSUdfVkZJT19DQ1cpICs9IGNjdy5vCiBvYmotJChDT05GSUdfU09GVE1NVSkgKz0g
cGxhdGZvcm0ubwogb2JqLSQoQ09ORklHX1ZGSU9fWEdNQUMpICs9IGNhbHhlZGEteGdtYWMubwpk
aWZmIC0tZ2l0IGEvaHcvdmZpby9taWdyYXRpb24uYyBiL2h3L3ZmaW8vbWlncmF0aW9uLmMKbmV3
IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMC4uMTZkNjM5NQotLS0gL2Rldi9udWxsCisr
KyBiL2h3L3ZmaW8vbWlncmF0aW9uLmMKQEAgLTAsMCArMSw2MzMgQEAKKyNpbmNsdWRlICJxZW11
L29zZGVwLmgiCisKKyNpbmNsdWRlICJody92ZmlvL3ZmaW8tY29tbW9uLmgiCisjaW5jbHVkZSAi
bWlncmF0aW9uL2Jsb2NrZXIuaCIKKyNpbmNsdWRlICJtaWdyYXRpb24vcmVnaXN0ZXIuaCIKKyNp
bmNsdWRlICJxYXBpL2Vycm9yLmgiCisjaW5jbHVkZSAicGNpLmgiCisjaW5jbHVkZSAic3lzZW11
L2t2bS5oIgorI2luY2x1ZGUgImV4ZWMvcmFtX2FkZHIuaCIKKworI2RlZmluZSBWRklPX1NBVkVf
RkxBR19TRVRVUCAwCisjZGVmaW5lIFZGSU9fU0FWRV9GTEFHX1BDSSAxCisjZGVmaW5lIFZGSU9f
U0FWRV9GTEFHX0RFVkNPTkZJRyAyCisjZGVmaW5lIFZGSU9fU0FWRV9GTEFHX0RFVk1FTU9SWSA0
CisjZGVmaW5lIFZGSU9fU0FWRV9GTEFHX0NPTlRJTlVFIDgKKworc3RhdGljIGludCB2ZmlvX2Rl
dmljZV9zdGF0ZV9yZWdpb25fc2V0dXAoVkZJT1BDSURldmljZSAqdmRldiwKKyAgICAgICAgVkZJ
T1JlZ2lvbiAqcmVnaW9uLCB1aW50MzJfdCBzdWJ0eXBlLCBjb25zdCBjaGFyICpuYW1lKQorewor
ICAgIFZGSU9EZXZpY2UgKnZiYXNlZGV2ID0gJnZkZXYtPnZiYXNlZGV2OworICAgIHN0cnVjdCB2
ZmlvX3JlZ2lvbl9pbmZvICppbmZvOworICAgIGludCByZXQ7CisKKyAgICByZXQgPSB2ZmlvX2dl
dF9kZXZfcmVnaW9uX2luZm8odmJhc2VkZXYsIFZGSU9fUkVHSU9OX1RZUEVfREVWSUNFX1NUQVRF
LAorICAgICAgICAgICAgc3VidHlwZSwgJmluZm8pOworICAgIGlmIChyZXQpIHsKKyAgICAgICAg
ZXJyb3JfcmVwb3J0KCJGYWlsZWQgdG8gZ2V0IGluZm8gb2YgcmVnaW9uICVzIiwgbmFtZSk7Cisg
ICAgICAgIHJldHVybiByZXQ7CisgICAgfQorCisgICAgaWYgKHZmaW9fcmVnaW9uX3NldHVwKE9C
SkVDVCh2ZGV2KSwgdmJhc2VkZXYsCisgICAgICAgICAgICByZWdpb24sIGluZm8tPmluZGV4LCBu
YW1lKSkgeworICAgICAgICBlcnJvcl9yZXBvcnQoIkZhaWxlZCB0byBzZXR1cCBtaWdydGlvbiBy
ZWdpb24gJXMiLCBuYW1lKTsKKyAgICAgICAgcmV0dXJuIHJldDsKKyAgICB9CisKKyAgICBpZiAo
dmZpb19yZWdpb25fbW1hcChyZWdpb24pKSB7CisgICAgICAgIGVycm9yX3JlcG9ydCgiRmFpbGVk
IHRvIG1tYXAgbWlncnRpb24gcmVnaW9uICVzIiwgbmFtZSk7CisgICAgfQorCisgICAgcmV0dXJu
IDA7Cit9CisKK2Jvb2wgdmZpb19kZXZpY2VfZGF0YV9jYXBfc3lzdGVtX21lbW9yeShWRklPUENJ
RGV2aWNlICp2ZGV2KQoreworICAgcmV0dXJuICEhKHZkZXYtPm1pZ3JhdGlvbi0+ZGF0YV9jYXBz
ICYgVkZJT19ERVZJQ0VfREFUQV9DQVBfU1lTVEVNX01FTU9SWSk7Cit9CisKK2Jvb2wgdmZpb19k
ZXZpY2VfZGF0YV9jYXBfZGV2aWNlX21lbW9yeShWRklPUENJRGV2aWNlICp2ZGV2KQoreworICAg
cmV0dXJuICEhKHZkZXYtPm1pZ3JhdGlvbi0+ZGF0YV9jYXBzICYgVkZJT19ERVZJQ0VfREFUQV9D
QVBfREVWSUNFX01FTU9SWSk7Cit9CisKK3N0YXRpYyBib29sIHZmaW9fZGV2aWNlX3N0YXRlX3Jl
Z2lvbl9tbWFwZWQoVkZJT1JlZ2lvbiAqcmVnaW9uKQoreworICAgIGJvb2wgbW1hcGVkID0gdHJ1
ZTsKKyAgICBpZiAocmVnaW9uLT5ucl9tbWFwcyAhPSAxIHx8IHJlZ2lvbi0+bW1hcHNbMF0ub2Zm
c2V0IHx8CisgICAgICAgICAgICAocmVnaW9uLT5zaXplICE9IHJlZ2lvbi0+bW1hcHNbMF0uc2l6
ZSkgfHwKKyAgICAgICAgICAgIChyZWdpb24tPm1tYXBzWzBdLm1tYXAgPT0gTlVMTCkpIHsKKyAg
ICAgICAgbW1hcGVkID0gZmFsc2U7CisgICAgfQorCisgICAgcmV0dXJuIG1tYXBlZDsKK30KKwor
c3RhdGljIGludCB2ZmlvX2dldF9kZXZpY2VfY29uZmlnX3NpemUoVkZJT1BDSURldmljZSAqdmRl
dikKK3sKKyAgICBWRklPRGV2aWNlICp2YmFzZWRldiA9ICZ2ZGV2LT52YmFzZWRldjsKKyAgICBW
RklPUmVnaW9uICpyZWdpb25fY3RsID0KKyAgICAgICAgJnZkZXYtPm1pZ3JhdGlvbi0+cmVnaW9u
W1ZGSU9fREVWU1RBVEVfUkVHSU9OX0NUTF07CisgICAgVkZJT1JlZ2lvbiAqcmVnaW9uX2NvbmZp
ZyA9CisgICAgICAgICZ2ZGV2LT5taWdyYXRpb24tPnJlZ2lvbltWRklPX0RFVlNUQVRFX1JFR0lP
Tl9EQVRBX0NPTkZJR107CisgICAgdWludDY0X3QgbGVuOworICAgIGludCBzejsKKworICAgIHN6
ID0gc2l6ZW9mKGxlbik7CisgICAgaWYgKHByZWFkKHZiYXNlZGV2LT5mZCwgJmxlbiwgc3osCisg
ICAgICAgICAgICAgICAgcmVnaW9uX2N0bC0+ZmRfb2Zmc2V0ICsKKyAgICAgICAgICAgICAgICBv
ZmZzZXRvZihzdHJ1Y3QgdmZpb19kZXZpY2Vfc3RhdGVfY3RsLCBkZXZpY2VfY29uZmlnLnNpemUp
KQorICAgICAgICAgICAgIT0gc3opIHsKKyAgICAgICAgZXJyb3JfcmVwb3J0KCJ2ZmlvOiBGYWls
ZWQgdG8gZ2V0IGxlbmd0aCBvZiBkZXZpY2UgY29uZmlnIik7CisgICAgICAgIHJldHVybiAtMTsK
KyAgICB9CisgICAgaWYgKGxlbiA+IHJlZ2lvbl9jb25maWctPnNpemUpIHsKKyAgICAgICAgZXJy
b3JfcmVwb3J0KCJ2ZmlvOiBFcnJvciBkZXZpY2UgY29uZmlnIGxlbmd0aCIpOworICAgICAgICBy
ZXR1cm4gLTE7CisgICAgfQorICAgIHZkZXYtPm1pZ3JhdGlvbi0+ZGV2Y29uZmlnX3NpemUgPSBs
ZW47CisKKyAgICByZXR1cm4gMDsKK30KKworc3RhdGljIGludCB2ZmlvX3NldF9kZXZpY2VfY29u
ZmlnX3NpemUoVkZJT1BDSURldmljZSAqdmRldiwgdWludDY0X3Qgc2l6ZSkKK3sKKyAgICBWRklP
RGV2aWNlICp2YmFzZWRldiA9ICZ2ZGV2LT52YmFzZWRldjsKKyAgICBWRklPUmVnaW9uICpyZWdp
b25fY3RsID0KKyAgICAgICAgJnZkZXYtPm1pZ3JhdGlvbi0+cmVnaW9uW1ZGSU9fREVWU1RBVEVf
UkVHSU9OX0NUTF07CisgICAgVkZJT1JlZ2lvbiAqcmVnaW9uX2NvbmZpZyA9CisgICAgICAgICZ2
ZGV2LT5taWdyYXRpb24tPnJlZ2lvbltWRklPX0RFVlNUQVRFX1JFR0lPTl9EQVRBX0NPTkZJR107
CisgICAgaW50IHN6OworCisgICAgaWYgKHNpemUgPiByZWdpb25fY29uZmlnLT5zaXplKSB7Cisg
ICAgICAgIHJldHVybiAtMTsKKyAgICB9CisKKyAgICBzeiA9IHNpemVvZihzaXplKTsKKyAgICBp
ZiAocHdyaXRlKHZiYXNlZGV2LT5mZCwgJnNpemUsIHN6LAorICAgICAgICAgICAgICAgIHJlZ2lv
bl9jdGwtPmZkX29mZnNldCArCisgICAgICAgICAgICAgICAgb2Zmc2V0b2Yoc3RydWN0IHZmaW9f
ZGV2aWNlX3N0YXRlX2N0bCwgZGV2aWNlX2NvbmZpZy5zaXplKSkKKyAgICAgICAgICAgICE9IHN6
KSB7CisgICAgICAgIGVycm9yX3JlcG9ydCgidmZpbzogRmFpbGVkIHRvIHNldCBsZW5ndGggb2Yg
ZGV2aWNlIGNvbmZpZyIpOworICAgICAgICByZXR1cm4gLTE7CisgICAgfQorICAgIHZkZXYtPm1p
Z3JhdGlvbi0+ZGV2Y29uZmlnX3NpemUgPSBzaXplOworICAgIHJldHVybiAwOworfQorCitzdGF0
aWMgaW50IHZmaW9fc2F2ZV9kYXRhX2RldmljZV9jb25maWcoVkZJT1BDSURldmljZSAqdmRldiwg
UUVNVUZpbGUgKmYpCit7CisgICAgVkZJT0RldmljZSAqdmJhc2VkZXYgPSAmdmRldi0+dmJhc2Vk
ZXY7CisgICAgVkZJT1JlZ2lvbiAqcmVnaW9uX2N0bCA9CisgICAgICAgICZ2ZGV2LT5taWdyYXRp
b24tPnJlZ2lvbltWRklPX0RFVlNUQVRFX1JFR0lPTl9DVExdOworICAgIFZGSU9SZWdpb24gKnJl
Z2lvbl9jb25maWcgPQorICAgICAgICAmdmRldi0+bWlncmF0aW9uLT5yZWdpb25bVkZJT19ERVZT
VEFURV9SRUdJT05fREFUQV9DT05GSUddOworICAgIHZvaWQgKmRlc3Q7CisgICAgdWludDMyX3Qg
c3o7CisgICAgdWludDhfdCAqYnVmID0gTlVMTDsKKyAgICB1aW50MzJfdCBhY3Rpb24gPSBWRklP
X0RFVklDRV9EQVRBX0FDVElPTl9HRVRfQlVGRkVSOworICAgIHVpbnQ2NF90IGxlbiA9IHZkZXYt
Pm1pZ3JhdGlvbi0+ZGV2Y29uZmlnX3NpemU7CisKKyAgICBxZW11X3B1dF9iZTY0KGYsIGxlbik7
CisKKyAgICBzeiA9IHNpemVvZihhY3Rpb24pOworICAgIGlmIChwd3JpdGUodmJhc2VkZXYtPmZk
LCAmYWN0aW9uLCBzeiwKKyAgICAgICAgICAgICAgICByZWdpb25fY3RsLT5mZF9vZmZzZXQgKwor
ICAgICAgICAgICAgICAgIG9mZnNldG9mKHN0cnVjdCB2ZmlvX2RldmljZV9zdGF0ZV9jdGwsIGRl
dmljZV9jb25maWcuYWN0aW9uKSkKKyAgICAgICAgICAgICE9IHN6KSB7CisgICAgICAgIGVycm9y
X3JlcG9ydCgidmZpbzogYWN0aW9uIGZhaWx1cmUgZm9yIGRldmljZSBjb25maWcgZ2V0IGJ1ZmZl
ciIpOworICAgICAgICByZXR1cm4gLTE7CisgICAgfQorCisgICAgaWYgKCF2ZmlvX2RldmljZV9z
dGF0ZV9yZWdpb25fbW1hcGVkKHJlZ2lvbl9jb25maWcpKSB7CisgICAgICAgIGJ1ZiA9IGdfbWFs
bG9jKGxlbik7CisgICAgICAgIGlmIChidWYgPT0gTlVMTCkgeworICAgICAgICAgICAgZXJyb3Jf
cmVwb3J0KCJ2ZmlvOiBGYWlsZWQgdG8gYWxsb2NhdGUgbWVtb3J5IGZvciBtaWdyYXRlIik7Cisg
ICAgICAgICAgICByZXR1cm4gLTE7CisgICAgICAgIH0KKyAgICAgICAgaWYgKHByZWFkKHZiYXNl
ZGV2LT5mZCwgYnVmLCBsZW4sIHJlZ2lvbl9jb25maWctPmZkX29mZnNldCkgIT0gbGVuKSB7Cisg
ICAgICAgICAgICBlcnJvcl9yZXBvcnQoInZmaW86IEZhaWxlZCByZWFkIGRldmljZSBjb25maWcg
YnVmZmVyIik7CisgICAgICAgICAgICByZXR1cm4gLTE7CisgICAgICAgIH0KKyAgICAgICAgcWVt
dV9wdXRfYnVmZmVyKGYsIGJ1ZiwgbGVuKTsKKyAgICAgICAgZ19mcmVlKGJ1Zik7CisgICAgfSBl
bHNlIHsKKyAgICAgICAgZGVzdCA9IHJlZ2lvbl9jb25maWctPm1tYXBzWzBdLm1tYXA7CisgICAg
ICAgIHFlbXVfcHV0X2J1ZmZlcihmLCBkZXN0LCBsZW4pOworICAgIH0KKyAgICByZXR1cm4gMDsK
K30KKworc3RhdGljIGludCB2ZmlvX2xvYWRfZGF0YV9kZXZpY2VfY29uZmlnKFZGSU9QQ0lEZXZp
Y2UgKnZkZXYsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgUUVNVUZpbGUgKmYsIHVpbnQ2
NF90IGxlbikKK3sKKyAgICBWRklPRGV2aWNlICp2YmFzZWRldiA9ICZ2ZGV2LT52YmFzZWRldjsK
KyAgICBWRklPUmVnaW9uICpyZWdpb25fY3RsID0KKyAgICAgICAgJnZkZXYtPm1pZ3JhdGlvbi0+
cmVnaW9uW1ZGSU9fREVWU1RBVEVfUkVHSU9OX0NUTF07CisgICAgVkZJT1JlZ2lvbiAqcmVnaW9u
X2NvbmZpZyA9CisgICAgICAgICZ2ZGV2LT5taWdyYXRpb24tPnJlZ2lvbltWRklPX0RFVlNUQVRF
X1JFR0lPTl9EQVRBX0NPTkZJR107CisgICAgdm9pZCAqZGVzdDsKKyAgICB1aW50MzJfdCBzejsK
KyAgICB1aW50OF90ICpidWYgPSBOVUxMOworICAgIHVpbnQzMl90IGFjdGlvbiA9IFZGSU9fREVW
SUNFX0RBVEFfQUNUSU9OX1NFVF9CVUZGRVI7CisKKyAgICB2ZmlvX3NldF9kZXZpY2VfY29uZmln
X3NpemUodmRldiwgbGVuKTsKKworICAgIGlmICghdmZpb19kZXZpY2Vfc3RhdGVfcmVnaW9uX21t
YXBlZChyZWdpb25fY29uZmlnKSkgeworICAgICAgICBidWYgPSBnX21hbGxvYyhsZW4pOworICAg
ICAgICBpZiAoYnVmID09IE5VTEwpIHsKKyAgICAgICAgICAgIGVycm9yX3JlcG9ydCgidmZpbzog
RmFpbGVkIHRvIGFsbG9jYXRlIG1lbW9yeSBmb3IgbWlncmF0ZSIpOworICAgICAgICAgICAgcmV0
dXJuIC0xOworICAgICAgICB9CisgICAgICAgIHFlbXVfZ2V0X2J1ZmZlcihmLCBidWYsIGxlbik7
CisgICAgICAgIGlmIChwd3JpdGUodmJhc2VkZXYtPmZkLCBidWYsIGxlbiwKKyAgICAgICAgICAg
ICAgICAgICAgcmVnaW9uX2NvbmZpZy0+ZmRfb2Zmc2V0KSAhPSBsZW4pIHsKKyAgICAgICAgICAg
IGVycm9yX3JlcG9ydCgidmZpbzogRmFpbGVkIHRvIHdyaXRlIGRldmllIGNvbmZpZyBidWZmZXIi
KTsKKyAgICAgICAgICAgIHJldHVybiAtMTsKKyAgICAgICAgfQorICAgICAgICBnX2ZyZWUoYnVm
KTsKKyAgICB9IGVsc2UgeworICAgICAgICBkZXN0ID0gcmVnaW9uX2NvbmZpZy0+bW1hcHNbMF0u
bW1hcDsKKyAgICAgICAgcWVtdV9nZXRfYnVmZmVyKGYsIGRlc3QsIGxlbik7CisgICAgfQorCisg
ICAgc3ogPSBzaXplb2YoYWN0aW9uKTsKKyAgICBpZiAocHdyaXRlKHZiYXNlZGV2LT5mZCwgJmFj
dGlvbiwgc3osCisgICAgICAgICAgICAgICAgcmVnaW9uX2N0bC0+ZmRfb2Zmc2V0ICsKKyAgICAg
ICAgICAgICAgICBvZmZzZXRvZihzdHJ1Y3QgdmZpb19kZXZpY2Vfc3RhdGVfY3RsLCBkZXZpY2Vf
Y29uZmlnLmFjdGlvbikpCisgICAgICAgICAgICAhPSBzeikgeworICAgICAgICBlcnJvcl9yZXBv
cnQoInZmaW86IGFjdGlvbiBmYWlsdXJlIGZvciBkZXZpY2UgY29uZmlnIHNldCBidWZmZXIiKTsK
KyAgICAgICAgcmV0dXJuIC0xOworICAgIH0KKworICAgIHJldHVybiAwOworfQorCitzdGF0aWMg
aW50IHZmaW9fc2V0X2RpcnR5X3BhZ2VfYml0bWFwX2NodW5rKFZGSU9QQ0lEZXZpY2UgKnZkZXYs
CisgICAgICAgIHVpbnQ2NF90IHN0YXJ0X2FkZHIsIHVpbnQ2NF90IHBhZ2VfbnIpCit7CisKKyAg
ICBWRklPRGV2aWNlICp2YmFzZWRldiA9ICZ2ZGV2LT52YmFzZWRldjsKKyAgICBWRklPUmVnaW9u
ICpyZWdpb25fY3RsID0KKyAgICAgICAgJnZkZXYtPm1pZ3JhdGlvbi0+cmVnaW9uW1ZGSU9fREVW
U1RBVEVfUkVHSU9OX0NUTF07CisgICAgVkZJT1JlZ2lvbiAqcmVnaW9uX2JpdG1hcCA9CisgICAg
ICAgICZ2ZGV2LT5taWdyYXRpb24tPnJlZ2lvbltWRklPX0RFVlNUQVRFX1JFR0lPTl9EQVRBX0JJ
VE1BUF07CisgICAgdW5zaWduZWQgbG9uZyBiaXRtYXBfc2l6ZSA9CisgICAgICAgICAgICAgICAg
ICAgIEJJVFNfVE9fTE9OR1MocGFnZV9ucikgKiBzaXplb2YodW5zaWduZWQgbG9uZyk7CisgICAg
dWludDMyX3Qgc3o7CisKKyAgICBzdHJ1Y3QgeworICAgICAgICBfX3U2NCBzdGFydF9hZGRyOwor
ICAgICAgICBfX3U2NCBwYWdlX25yOworICAgIH0gc3lzdGVtX21lbW9yeTsKKyAgICBzeXN0ZW1f
bWVtb3J5LnN0YXJ0X2FkZHIgPSBzdGFydF9hZGRyOworICAgIHN5c3RlbV9tZW1vcnkucGFnZV9u
ciA9IHBhZ2VfbnI7CisgICAgc3ogPSBzaXplb2Yoc3lzdGVtX21lbW9yeSk7CisgICAgaWYgKHB3
cml0ZSh2YmFzZWRldi0+ZmQsICZzeXN0ZW1fbWVtb3J5LCBzeiwKKyAgICAgICAgICAgICAgICBy
ZWdpb25fY3RsLT5mZF9vZmZzZXQgKworICAgICAgICAgICAgICAgIG9mZnNldG9mKHN0cnVjdCB2
ZmlvX2RldmljZV9zdGF0ZV9jdGwsIHN5c3RlbV9tZW1vcnkpKQorICAgICAgICAgICAgIT0gc3op
IHsKKyAgICAgICAgZXJyb3JfcmVwb3J0KCJ2ZmlvOiBGYWlsZWQgdG8gc2V0IHN5c3RlbSBtZW1v
cnkgcmFuZ2UgZm9yIGRpcnR5IHBhZ2VzIik7CisgICAgICAgIHJldHVybiAtMTsKKyAgICB9CisK
KyAgICBpZiAoIXZmaW9fZGV2aWNlX3N0YXRlX3JlZ2lvbl9tbWFwZWQocmVnaW9uX2JpdG1hcCkp
IHsKKyAgICAgICAgdm9pZCAqYml0bWFwID0gZ19tYWxsb2MwKGJpdG1hcF9zaXplKTsKKworICAg
ICAgICBpZiAocHJlYWQodmJhc2VkZXYtPmZkLCBiaXRtYXAsIGJpdG1hcF9zaXplLAorICAgICAg
ICAgICAgICAgICAgICByZWdpb25fYml0bWFwLT5mZF9vZmZzZXQpICE9IGJpdG1hcF9zaXplKSB7
CisgICAgICAgICAgICBlcnJvcl9yZXBvcnQoInZmaW86IEZhaWxlZCB0byByZWFkIGRpcnR5IGJp
dG1hcCBkYXRhIik7CisgICAgICAgICAgICByZXR1cm4gLTE7CisgICAgICAgIH0KKworICAgICAg
ICBjcHVfcGh5c2ljYWxfbWVtb3J5X3NldF9kaXJ0eV9sZWJpdG1hcChiaXRtYXAsIHN0YXJ0X2Fk
ZHIsIHBhZ2VfbnIpOworCisgICAgICAgIGdfZnJlZShiaXRtYXApOworICAgIH0gZWxzZSB7Cisg
ICAgICAgIGNwdV9waHlzaWNhbF9tZW1vcnlfc2V0X2RpcnR5X2xlYml0bWFwKAorICAgICAgICAg
ICAgICAgICAgICByZWdpb25fYml0bWFwLT5tbWFwc1swXS5tbWFwLAorICAgICAgICAgICAgICAg
ICAgICBzdGFydF9hZGRyLCBwYWdlX25yKTsKKyAgICB9CisgICByZXR1cm4gMDsKK30KKworaW50
IHZmaW9fc2V0X2RpcnR5X3BhZ2VfYml0bWFwKFZGSU9QQ0lEZXZpY2UgKnZkZXYsCisgICAgICAg
IHVpbnQ2NF90IHN0YXJ0X2FkZHIsIHVpbnQ2NF90IHBhZ2VfbnIpCit7CisgICAgVkZJT1JlZ2lv
biAqcmVnaW9uX2JpdG1hcCA9CisgICAgICAgICZ2ZGV2LT5taWdyYXRpb24tPnJlZ2lvbltWRklP
X0RFVlNUQVRFX1JFR0lPTl9EQVRBX0JJVE1BUF07CisgICAgdW5zaWduZWQgbG9uZyBjaHVua19z
aXplID0gcmVnaW9uX2JpdG1hcC0+c2l6ZTsKKyAgICB1aW50NjRfdCBjaHVua19wZ19uciA9IChj
aHVua19zaXplIC8gc2l6ZW9mKHVuc2lnbmVkIGxvbmcpKSAqCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIEJJVFNfUEVSX0xPTkc7CisKKyAgICB1aW50NjRfdCBjbnRfbGVmdDsKKyAg
ICBpbnQgcmMgPSAwOworCisgICAgY250X2xlZnQgPSBwYWdlX25yOworCisgICAgd2hpbGUgKGNu
dF9sZWZ0ID49IGNodW5rX3BnX25yKSB7CisgICAgICAgIHJjID0gdmZpb19zZXRfZGlydHlfcGFn
ZV9iaXRtYXBfY2h1bmsodmRldiwgc3RhcnRfYWRkciwgY2h1bmtfcGdfbnIpOworICAgICAgICBp
ZiAocmMpIHsKKyAgICAgICAgICAgIGdvdG8gZXhpdDsKKyAgICAgICAgfQorICAgICAgICBjbnRf
bGVmdCAtPSBjaHVua19wZ19ucjsKKyAgICAgICAgc3RhcnRfYWRkciArPSBzdGFydF9hZGRyOwor
ICAgfQorICAgcmMgPSB2ZmlvX3NldF9kaXJ0eV9wYWdlX2JpdG1hcF9jaHVuayh2ZGV2LCBzdGFy
dF9hZGRyLCBjbnRfbGVmdCk7CisKK2V4aXQ6CisgICByZXR1cm4gcmM7Cit9CisKK3N0YXRpYyBp
bnQgdmZpb19zZXRfZGV2aWNlX3N0YXRlKFZGSU9QQ0lEZXZpY2UgKnZkZXYsCisgICAgICAgIHVp
bnQzMl90IGRldl9zdGF0ZSkKK3sKKyAgICBWRklPRGV2aWNlICp2YmFzZWRldiA9ICZ2ZGV2LT52
YmFzZWRldjsKKyAgICBWRklPUmVnaW9uICpyZWdpb24gPQorICAgICAgICAmdmRldi0+bWlncmF0
aW9uLT5yZWdpb25bVkZJT19ERVZTVEFURV9SRUdJT05fQ1RMXTsKKyAgICB1aW50MzJfdCBzeiA9
IHNpemVvZihkZXZfc3RhdGUpOworCisgICAgaWYgKCF2ZGV2LT5taWdyYXRpb24pIHsKKyAgICAg
ICAgcmV0dXJuIC0xOworICAgIH0KKworICAgIGlmIChwd3JpdGUodmJhc2VkZXYtPmZkLCAmZGV2
X3N0YXRlLCBzeiwKKyAgICAgICAgICAgICAgcmVnaW9uLT5mZF9vZmZzZXQgKworICAgICAgICAg
ICAgICBvZmZzZXRvZihzdHJ1Y3QgdmZpb19kZXZpY2Vfc3RhdGVfY3RsLCBkZXZpY2Vfc3RhdGUp
KQorICAgICAgICAgICAgIT0gc3opIHsKKyAgICAgICAgZXJyb3JfcmVwb3J0KCJ2ZmlvOiBGYWls
ZWQgdG8gc2V0IGRldmljZSBzdGF0ZSAlZCIsIGRldl9zdGF0ZSk7CisgICAgICAgIHJldHVybiAt
MTsKKyAgICB9CisgICAgdmRldi0+bWlncmF0aW9uLT5kZXZpY2Vfc3RhdGUgPSBkZXZfc3RhdGU7
CisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgdmZpb19nZXRfZGV2aWNlX2RhdGFfY2Fw
cyhWRklPUENJRGV2aWNlICp2ZGV2KQoreworICAgIFZGSU9EZXZpY2UgKnZiYXNlZGV2ID0gJnZk
ZXYtPnZiYXNlZGV2OworICAgIFZGSU9SZWdpb24gKnJlZ2lvbiA9CisgICAgICAgICZ2ZGV2LT5t
aWdyYXRpb24tPnJlZ2lvbltWRklPX0RFVlNUQVRFX1JFR0lPTl9DVExdOworCisgICAgdWludDMy
X3QgY2FwczsKKyAgICB1aW50MzJfdCBzaXplID0gc2l6ZW9mKGNhcHMpOworCisgICAgaWYgKHBy
ZWFkKHZiYXNlZGV2LT5mZCwgJmNhcHMsIHNpemUsCisgICAgICAgICAgICAgICAgcmVnaW9uLT5m
ZF9vZmZzZXQgKworICAgICAgICAgICAgICAgIG9mZnNldG9mKHN0cnVjdCB2ZmlvX2RldmljZV9z
dGF0ZV9jdGwsIGNhcHMpKQorICAgICAgICAgICAgIT0gc2l6ZSkgeworICAgICAgICBlcnJvcl9y
ZXBvcnQoIiVzIEZhaWxlZCB0byByZWFkIGRhdGEgY2FwcyBvZiBkZXZpY2Ugc3RhdGVzIiwKKyAg
ICAgICAgICAgICAgICB2YmFzZWRldi0+bmFtZSk7CisgICAgICAgIHJldHVybiAtMTsKKyAgICB9
CisgICAgdmRldi0+bWlncmF0aW9uLT5kYXRhX2NhcHMgPSBjYXBzOworICAgIHJldHVybiAwOwor
fQorCisKK3N0YXRpYyBpbnQgdmZpb19jaGVja19kZXZzdGF0ZV92ZXJzaW9uKFZGSU9QQ0lEZXZp
Y2UgKnZkZXYpCit7CisgICAgVkZJT0RldmljZSAqdmJhc2VkZXYgPSAmdmRldi0+dmJhc2VkZXY7
CisgICAgVkZJT1JlZ2lvbiAqcmVnaW9uID0KKyAgICAgICAgJnZkZXYtPm1pZ3JhdGlvbi0+cmVn
aW9uW1ZGSU9fREVWU1RBVEVfUkVHSU9OX0NUTF07CisKKyAgICB1aW50MzJfdCB2ZXJzaW9uOwor
ICAgIHVpbnQzMl90IHNpemUgPSBzaXplb2YodmVyc2lvbik7CisKKyAgICBpZiAocHJlYWQodmJh
c2VkZXYtPmZkLCAmdmVyc2lvbiwgc2l6ZSwKKyAgICAgICAgICAgICAgICByZWdpb24tPmZkX29m
ZnNldCArCisgICAgICAgICAgICAgICAgb2Zmc2V0b2Yoc3RydWN0IHZmaW9fZGV2aWNlX3N0YXRl
X2N0bCwgdmVyc2lvbikpCisgICAgICAgICAgICAhPSBzaXplKSB7CisgICAgICAgIGVycm9yX3Jl
cG9ydCgiJXMgRmFpbGVkIHRvIHJlYWQgdmVyc2lvbiBvZiBkZXZpY2Ugc3RhdGUgaW50ZXJmYWNl
cyIsCisgICAgICAgICAgICAgICAgdmJhc2VkZXYtPm5hbWUpOworICAgICAgICByZXR1cm4gLTE7
CisgICAgfQorCisgICAgaWYgKHZlcnNpb24gIT0gVkZJT19ERVZJQ0VfU1RBVEVfSU5URVJGQUNF
X1ZFUlNJT04pIHsKKyAgICAgICAgZXJyb3JfcmVwb3J0KCIlcyBtaWdyYXRpb24gdmVyc2lvbiBt
aXNtYXRjaCwgcmlnaHQgdmVyc2lvbiBpcyAlZCIsCisgICAgICAgICAgICAgICAgdmJhc2VkZXYt
Pm5hbWUsIFZGSU9fREVWSUNFX1NUQVRFX0lOVEVSRkFDRV9WRVJTSU9OKTsKKyAgICAgICAgcmV0
dXJuIC0xOworICAgIH0KKworICAgIHJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCB2ZmlvX3Zt
X2NoYW5nZV9zdGF0ZV9oYW5kbGVyKHZvaWQgKnB2LCBpbnQgcnVubmluZywgUnVuU3RhdGUgc3Rh
dGUpCit7CisgICAgVkZJT1BDSURldmljZSAqdmRldiA9IHB2OworICAgIHVpbnQzMl90IGRldl9z
dGF0ZSA9IHZkZXYtPm1pZ3JhdGlvbi0+ZGV2aWNlX3N0YXRlOworCisgICAgaWYgKCFydW5uaW5n
KSB7CisgICAgICAgIGRldl9zdGF0ZSB8PSBWRklPX0RFVklDRV9TVEFURV9TVE9QOworICAgIH0g
ZWxzZSB7CisgICAgICAgIGRldl9zdGF0ZSAmPSB+VkZJT19ERVZJQ0VfU1RBVEVfU1RPUDsKKyAg
ICB9CisKKyAgICB2ZmlvX3NldF9kZXZpY2Vfc3RhdGUodmRldiwgZGV2X3N0YXRlKTsKK30KKwor
c3RhdGljIHZvaWQgdmZpb19zYXZlX2xpdmVfcGVuZGluZyhRRU1VRmlsZSAqZiwgdm9pZCAqb3Bh
cXVlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50NjRfdCBtYXhfc2l6
ZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDY0X3QgKnJlc19wcmVj
b3B5X29ubHksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ2NF90ICpy
ZXNfY29tcGF0aWJsZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDY0
X3QgKnJlc19wb3N0X2NvcHlfb25seSkKK3sKKyAgICBWRklPUENJRGV2aWNlICp2ZGV2ID0gb3Bh
cXVlOworCisgICAgaWYgKCF2ZmlvX2RldmljZV9kYXRhX2NhcF9kZXZpY2VfbWVtb3J5KHZkZXYp
KSB7CisgICAgICAgIHJldHVybjsKKyAgICB9CisKKyAgICByZXR1cm47Cit9CisKK3N0YXRpYyBp
bnQgdmZpb19zYXZlX2l0ZXJhdGUoUUVNVUZpbGUgKmYsIHZvaWQgKm9wYXF1ZSkKK3sKKyAgICBW
RklPUENJRGV2aWNlICp2ZGV2ID0gb3BhcXVlOworCisgICAgaWYgKCF2ZmlvX2RldmljZV9kYXRh
X2NhcF9kZXZpY2VfbWVtb3J5KHZkZXYpKSB7CisgICAgICAgIHJldHVybiAwOworICAgIH0KKwor
ICAgIHJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCB2ZmlvX3BjaV9sb2FkX2NvbmZpZyhWRklP
UENJRGV2aWNlICp2ZGV2LCBRRU1VRmlsZSAqZikKK3sKKyAgICBQQ0lEZXZpY2UgKnBkZXYgPSAm
dmRldi0+cGRldjsKKyAgICB1aW50MzJfdCBjdGwsIG1zaV9sbywgbXNpX2hpLCBtc2lfZGF0YSwg
YmFyX2NmZywgaTsKKyAgICBib29sIG1zaV82NGJpdDsKKworICAgIC8qIHJldG9yZSBwY2kgYmFy
IGNvbmZpZ3VyYXRpb24gKi8KKyAgICBjdGwgPSBwY2lfZGVmYXVsdF9yZWFkX2NvbmZpZyhwZGV2
LCBQQ0lfQ09NTUFORCwgMik7CisgICAgdmZpb19wY2lfd3JpdGVfY29uZmlnKHBkZXYsIFBDSV9D
T01NQU5ELAorICAgICAgICAgICAgY3RsICYgKCEoUENJX0NPTU1BTkRfSU8gfCBQQ0lfQ09NTUFO
RF9NRU1PUlkpKSwgMik7CisgICAgZm9yIChpID0gMDsgaSA8IFBDSV9ST01fU0xPVDsgaSsrKSB7
CisgICAgICAgIGJhcl9jZmcgPSBxZW11X2dldF9iZTMyKGYpOworICAgICAgICB2ZmlvX3BjaV93
cml0ZV9jb25maWcocGRldiwgUENJX0JBU0VfQUREUkVTU18wICsgaSAqIDQsIGJhcl9jZmcsIDQp
OworICAgIH0KKyAgICB2ZmlvX3BjaV93cml0ZV9jb25maWcocGRldiwgUENJX0NPTU1BTkQsCisg
ICAgICAgICAgICBjdGwgfCBQQ0lfQ09NTUFORF9JTyB8IFBDSV9DT01NQU5EX01FTU9SWSwgMik7
CisKKyAgICAvKiByZXN0b3JlIG1zaSBjb25maWd1cmF0aW9uICovCisgICAgY3RsID0gcGNpX2Rl
ZmF1bHRfcmVhZF9jb25maWcocGRldiwgcGRldi0+bXNpX2NhcCArIFBDSV9NU0lfRkxBR1MsIDIp
OworICAgIG1zaV82NGJpdCA9ICEhKGN0bCAmIFBDSV9NU0lfRkxBR1NfNjRCSVQpOworCisgICAg
dmZpb19wY2lfd3JpdGVfY29uZmlnKCZ2ZGV2LT5wZGV2LAorICAgICAgICAgICAgcGRldi0+bXNp
X2NhcCArIFBDSV9NU0lfRkxBR1MsCisgICAgICAgICAgICBjdGwgJiAoIVBDSV9NU0lfRkxBR1Nf
RU5BQkxFKSwgMik7CisKKyAgICBtc2lfbG8gPSBxZW11X2dldF9iZTMyKGYpOworICAgIHZmaW9f
cGNpX3dyaXRlX2NvbmZpZyhwZGV2LCBwZGV2LT5tc2lfY2FwICsgUENJX01TSV9BRERSRVNTX0xP
LCBtc2lfbG8sIDQpOworCisgICAgaWYgKG1zaV82NGJpdCkgeworICAgICAgICBtc2lfaGkgPSBx
ZW11X2dldF9iZTMyKGYpOworICAgICAgICB2ZmlvX3BjaV93cml0ZV9jb25maWcocGRldiwgcGRl
di0+bXNpX2NhcCArIFBDSV9NU0lfQUREUkVTU19ISSwKKyAgICAgICAgICAgICAgICBtc2lfaGks
IDQpOworICAgIH0KKyAgICBtc2lfZGF0YSA9IHFlbXVfZ2V0X2JlMzIoZik7CisgICAgdmZpb19w
Y2lfd3JpdGVfY29uZmlnKHBkZXYsCisgICAgICAgICAgICBwZGV2LT5tc2lfY2FwICsgKG1zaV82
NGJpdCA/IFBDSV9NU0lfREFUQV82NCA6IFBDSV9NU0lfREFUQV8zMiksCisgICAgICAgICAgICBt
c2lfZGF0YSwgMik7CisKKyAgICB2ZmlvX3BjaV93cml0ZV9jb25maWcoJnZkZXYtPnBkZXYsIHBk
ZXYtPm1zaV9jYXAgKyBQQ0lfTVNJX0ZMQUdTLAorICAgICAgICAgICAgY3RsIHwgUENJX01TSV9G
TEFHU19FTkFCTEUsIDIpOworCit9CisKK3N0YXRpYyBpbnQgdmZpb19sb2FkX3N0YXRlKFFFTVVG
aWxlICpmLCB2b2lkICpvcGFxdWUsIGludCB2ZXJzaW9uX2lkKQoreworICAgIFZGSU9QQ0lEZXZp
Y2UgKnZkZXYgPSBvcGFxdWU7CisgICAgaW50IGZsYWc7CisgICAgdWludDY0X3QgbGVuOworICAg
IGludCByZXQgPSAwOworCisgICAgaWYgKHZlcnNpb25faWQgIT0gVkZJT19ERVZJQ0VfU1RBVEVf
SU5URVJGQUNFX1ZFUlNJT04pIHsKKyAgICAgICAgcmV0dXJuIC1FSU5WQUw7CisgICAgfQorCisg
ICAgZG8geworICAgICAgICBmbGFnID0gcWVtdV9nZXRfYnl0ZShmKTsKKworICAgICAgICBzd2l0
Y2ggKGZsYWcgJiB+VkZJT19TQVZFX0ZMQUdfQ09OVElOVUUpIHsKKyAgICAgICAgY2FzZSBWRklP
X1NBVkVfRkxBR19TRVRVUDoKKyAgICAgICAgICAgIGJyZWFrOworICAgICAgICBjYXNlIFZGSU9f
U0FWRV9GTEFHX1BDSToKKyAgICAgICAgICAgIHZmaW9fcGNpX2xvYWRfY29uZmlnKHZkZXYsIGYp
OworICAgICAgICAgICAgYnJlYWs7CisgICAgICAgIGNhc2UgVkZJT19TQVZFX0ZMQUdfREVWQ09O
RklHOgorICAgICAgICAgICAgbGVuID0gcWVtdV9nZXRfYmU2NChmKTsKKyAgICAgICAgICAgIHZm
aW9fbG9hZF9kYXRhX2RldmljZV9jb25maWcodmRldiwgZiwgbGVuKTsKKyAgICAgICAgICAgIGJy
ZWFrOworICAgICAgICBkZWZhdWx0OgorICAgICAgICAgICAgcmV0ID0gLUVJTlZBTDsKKyAgICAg
ICAgfQorICAgIH0gd2hpbGUgKGZsYWcgJiBWRklPX1NBVkVfRkxBR19DT05USU5VRSk7CisKKyAg
ICByZXR1cm4gcmV0OworfQorCitzdGF0aWMgdm9pZCB2ZmlvX3BjaV9zYXZlX2NvbmZpZyhWRklP
UENJRGV2aWNlICp2ZGV2LCBRRU1VRmlsZSAqZikKK3sKKyAgICBQQ0lEZXZpY2UgKnBkZXYgPSAm
dmRldi0+cGRldjsKKyAgICB1aW50MzJfdCBtc2lfY2ZnLCBtc2lfbG8sIG1zaV9oaSwgbXNpX2Rh
dGEsIGJhcl9jZmcsIGk7CisgICAgYm9vbCBtc2lfNjRiaXQ7CisKKyAgICBmb3IgKGkgPSAwOyBp
IDwgUENJX1JPTV9TTE9UOyBpKyspIHsKKyAgICAgICAgYmFyX2NmZyA9IHBjaV9kZWZhdWx0X3Jl
YWRfY29uZmlnKHBkZXYsIFBDSV9CQVNFX0FERFJFU1NfMCArIGkgKiA0LCA0KTsKKyAgICAgICAg
cWVtdV9wdXRfYmUzMihmLCBiYXJfY2ZnKTsKKyAgICB9CisKKyAgICBtc2lfY2ZnID0gcGNpX2Rl
ZmF1bHRfcmVhZF9jb25maWcocGRldiwgcGRldi0+bXNpX2NhcCArIFBDSV9NU0lfRkxBR1MsIDIp
OworICAgIG1zaV82NGJpdCA9ICEhKG1zaV9jZmcgJiBQQ0lfTVNJX0ZMQUdTXzY0QklUKTsKKwor
ICAgIG1zaV9sbyA9IHBjaV9kZWZhdWx0X3JlYWRfY29uZmlnKHBkZXYsCisgICAgICAgICAgICBw
ZGV2LT5tc2lfY2FwICsgUENJX01TSV9BRERSRVNTX0xPLCA0KTsKKyAgICBxZW11X3B1dF9iZTMy
KGYsIG1zaV9sbyk7CisKKyAgICBpZiAobXNpXzY0Yml0KSB7CisgICAgICAgIG1zaV9oaSA9IHBj
aV9kZWZhdWx0X3JlYWRfY29uZmlnKHBkZXYsCisgICAgICAgICAgICAgICAgcGRldi0+bXNpX2Nh
cCArIFBDSV9NU0lfQUREUkVTU19ISSwKKyAgICAgICAgICAgICAgICA0KTsKKyAgICAgICAgcWVt
dV9wdXRfYmUzMihmLCBtc2lfaGkpOworICAgIH0KKworICAgIG1zaV9kYXRhID0gcGNpX2RlZmF1
bHRfcmVhZF9jb25maWcocGRldiwKKyAgICAgICAgICAgIHBkZXYtPm1zaV9jYXAgKyAobXNpXzY0
Yml0ID8gUENJX01TSV9EQVRBXzY0IDogUENJX01TSV9EQVRBXzMyKSwKKyAgICAgICAgICAgIDIp
OworICAgIHFlbXVfcHV0X2JlMzIoZiwgbXNpX2RhdGEpOworCit9CisKK3N0YXRpYyBpbnQgdmZp
b19zYXZlX2NvbXBsZXRlX3ByZWNvcHkoUUVNVUZpbGUgKmYsIHZvaWQgKm9wYXF1ZSkKK3sKKyAg
ICBWRklPUENJRGV2aWNlICp2ZGV2ID0gb3BhcXVlOworICAgIGludCByYyA9IDA7CisKKyAgICBx
ZW11X3B1dF9ieXRlKGYsIFZGSU9fU0FWRV9GTEFHX1BDSSB8IFZGSU9fU0FWRV9GTEFHX0NPTlRJ
TlVFKTsKKyAgICB2ZmlvX3BjaV9zYXZlX2NvbmZpZyh2ZGV2LCBmKTsKKworICAgIHFlbXVfcHV0
X2J5dGUoZiwgVkZJT19TQVZFX0ZMQUdfREVWQ09ORklHKTsKKyAgICByYyArPSB2ZmlvX2dldF9k
ZXZpY2VfY29uZmlnX3NpemUodmRldik7CisgICAgcmMgKz0gdmZpb19zYXZlX2RhdGFfZGV2aWNl
X2NvbmZpZyh2ZGV2LCBmKTsKKworICAgIHJldHVybiByYzsKK30KKworc3RhdGljIGludCB2Zmlv
X3NhdmVfc2V0dXAoUUVNVUZpbGUgKmYsIHZvaWQgKm9wYXF1ZSkKK3sKKyAgICBWRklPUENJRGV2
aWNlICp2ZGV2ID0gb3BhcXVlOworICAgIHFlbXVfcHV0X2J5dGUoZiwgVkZJT19TQVZFX0ZMQUdf
U0VUVVApOworCisgICAgdmZpb19zZXRfZGV2aWNlX3N0YXRlKHZkZXYsIFZGSU9fREVWSUNFX1NU
QVRFX1JVTk5JTkcgfAorICAgICAgICAgICAgVkZJT19ERVZJQ0VfU1RBVEVfTE9HR0lORyk7Cisg
ICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgdmZpb19sb2FkX3NldHVwKFFFTVVGaWxlICpm
LCB2b2lkICpvcGFxdWUpCit7CisgICAgcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIHZmaW9f
c2F2ZV9jbGVhbnVwKHZvaWQgKm9wYXF1ZSkKK3sKKyAgICBWRklPUENJRGV2aWNlICp2ZGV2ID0g
b3BhcXVlOworICAgIHVpbnQzMl90IGRldl9zdGF0ZSA9IHZkZXYtPm1pZ3JhdGlvbi0+ZGV2aWNl
X3N0YXRlOworCisgICAgZGV2X3N0YXRlICY9IH5WRklPX0RFVklDRV9TVEFURV9MT0dHSU5HOwor
CisgICAgdmZpb19zZXRfZGV2aWNlX3N0YXRlKHZkZXYsIGRldl9zdGF0ZSk7Cit9CisKK3N0YXRp
YyBTYXZlVk1IYW5kbGVycyBzYXZldm1fdmZpb19oYW5kbGVycyA9IHsKKyAgICAuc2F2ZV9zZXR1
cCA9IHZmaW9fc2F2ZV9zZXR1cCwKKyAgICAuc2F2ZV9saXZlX3BlbmRpbmcgPSB2ZmlvX3NhdmVf
bGl2ZV9wZW5kaW5nLAorICAgIC5zYXZlX2xpdmVfaXRlcmF0ZSA9IHZmaW9fc2F2ZV9pdGVyYXRl
LAorICAgIC5zYXZlX2xpdmVfY29tcGxldGVfcHJlY29weSA9IHZmaW9fc2F2ZV9jb21wbGV0ZV9w
cmVjb3B5LAorICAgIC5zYXZlX2NsZWFudXAgPSB2ZmlvX3NhdmVfY2xlYW51cCwKKyAgICAubG9h
ZF9zZXR1cCA9IHZmaW9fbG9hZF9zZXR1cCwKKyAgICAubG9hZF9zdGF0ZSA9IHZmaW9fbG9hZF9z
dGF0ZSwKK307CisKK2ludCB2ZmlvX21pZ3JhdGlvbl9pbml0KFZGSU9QQ0lEZXZpY2UgKnZkZXYs
IEVycm9yICoqZXJycCkKK3sKKyAgICBpbnQgcmV0OworICAgIEVycm9yICpsb2NhbF9lcnIgPSBO
VUxMOworICAgIHZkZXYtPm1pZ3JhdGlvbiA9IGdfbmV3MChWRklPTWlncmF0aW9uLCAxKTsKKwor
ICAgIGlmICh2ZmlvX2RldmljZV9zdGF0ZV9yZWdpb25fc2V0dXAodmRldiwKKyAgICAgICAgICAg
ICAgJnZkZXYtPm1pZ3JhdGlvbi0+cmVnaW9uW1ZGSU9fREVWU1RBVEVfUkVHSU9OX0NUTF0sCisg
ICAgICAgICAgICAgIFZGSU9fUkVHSU9OX1NVQlRZUEVfREVWSUNFX1NUQVRFX0NUTCwKKyAgICAg
ICAgICAgICAgImRldmljZS1zdGF0ZS1jdGwiKSkgeworICAgICAgICBnb3RvIGVycm9yOworICAg
IH0KKworICAgIGlmICh2ZmlvX2NoZWNrX2RldnN0YXRlX3ZlcnNpb24odmRldikpIHsKKyAgICAg
ICAgZ290byBlcnJvcjsKKyAgICB9CisKKyAgICBpZiAodmZpb19nZXRfZGV2aWNlX2RhdGFfY2Fw
cyh2ZGV2KSkgeworICAgICAgICBnb3RvIGVycm9yOworICAgIH0KKworICAgIGlmICh2ZmlvX2Rl
dmljZV9zdGF0ZV9yZWdpb25fc2V0dXAodmRldiwKKyAgICAgICAgICAgICAgJnZkZXYtPm1pZ3Jh
dGlvbi0+cmVnaW9uW1ZGSU9fREVWU1RBVEVfUkVHSU9OX0RBVEFfQ09ORklHXSwKKyAgICAgICAg
ICAgICAgVkZJT19SRUdJT05fU1VCVFlQRV9ERVZJQ0VfU1RBVEVfREFUQV9DT05GSUcsCisgICAg
ICAgICAgICAgICJkZXZpY2Utc3RhdGUtZGF0YS1kZXZpY2UtY29uZmlnIikpIHsKKyAgICAgICAg
Z290byBlcnJvcjsKKyAgICB9CisKKyAgICBpZiAodmZpb19kZXZpY2VfZGF0YV9jYXBfZGV2aWNl
X21lbW9yeSh2ZGV2KSkgeworICAgICAgICBlcnJvcl9yZXBvcnQoIk5vIHN1cHBwb3J0IG9mIGRh
dGEgY2FwIGRldmljZSBtZW1vcnkgWWV0Iik7CisgICAgICAgIGdvdG8gZXJyb3I7CisgICAgfQor
CisgICAgaWYgKHZmaW9fZGV2aWNlX2RhdGFfY2FwX3N5c3RlbV9tZW1vcnkodmRldikgJiYKKyAg
ICAgICAgICAgIHZmaW9fZGV2aWNlX3N0YXRlX3JlZ2lvbl9zZXR1cCh2ZGV2LAorICAgICAgICAg
ICAgICAmdmRldi0+bWlncmF0aW9uLT5yZWdpb25bVkZJT19ERVZTVEFURV9SRUdJT05fREFUQV9C
SVRNQVBdLAorICAgICAgICAgICAgICBWRklPX1JFR0lPTl9TVUJUWVBFX0RFVklDRV9TVEFURV9E
QVRBX0RJUlRZQklUTUFQLAorICAgICAgICAgICAgICAiZGV2aWNlLXN0YXRlLWRhdGEtZGlydHli
aXRtYXAiKSkgeworICAgICAgICBnb3RvIGVycm9yOworICAgIH0KKworICAgIHZkZXYtPm1pZ3Jh
dGlvbi0+ZGV2aWNlX3N0YXRlID0gVkZJT19ERVZJQ0VfU1RBVEVfUlVOTklORzsKKworICAgIHJl
Z2lzdGVyX3NhdmV2bV9saXZlKE5VTEwsIFRZUEVfVkZJT19QQ0ksIC0xLAorICAgICAgICAgICAg
VkZJT19ERVZJQ0VfU1RBVEVfSU5URVJGQUNFX1ZFUlNJT04sCisgICAgICAgICAgICAmc2F2ZXZt
X3ZmaW9faGFuZGxlcnMsCisgICAgICAgICAgICB2ZGV2KTsKKworICAgIHZkZXYtPm1pZ3JhdGlv
bi0+dm1fc3RhdGUgPQorICAgICAgICBxZW11X2FkZF92bV9jaGFuZ2Vfc3RhdGVfaGFuZGxlcih2
ZmlvX3ZtX2NoYW5nZV9zdGF0ZV9oYW5kbGVyLCB2ZGV2KTsKKworICAgIHJldHVybiAwOworZXJy
b3I6CisgICAgZXJyb3Jfc2V0ZygmdmRldi0+bWlncmF0aW9uX2Jsb2NrZXIsCisgICAgICAgICAg
ICAiVkZJTyBkZXZpY2UgZG9lc24ndCBzdXBwb3J0IG1pZ3JhdGlvbiIpOworICAgIHJldCA9IG1p
Z3JhdGVfYWRkX2Jsb2NrZXIodmRldi0+bWlncmF0aW9uX2Jsb2NrZXIsICZsb2NhbF9lcnIpOwor
ICAgIGlmIChsb2NhbF9lcnIpIHsKKyAgICAgICAgZXJyb3JfcHJvcGFnYXRlKGVycnAsIGxvY2Fs
X2Vycik7CisgICAgICAgIGVycm9yX2ZyZWUodmRldi0+bWlncmF0aW9uX2Jsb2NrZXIpOworICAg
IH0KKworICAgIGdfZnJlZSh2ZGV2LT5taWdyYXRpb24pOworICAgIHZkZXYtPm1pZ3JhdGlvbiA9
IE5VTEw7CisKKyAgICByZXR1cm4gcmV0OworfQorCit2b2lkIHZmaW9fbWlncmF0aW9uX2ZpbmFs
aXplKFZGSU9QQ0lEZXZpY2UgKnZkZXYpCit7CisgICAgaWYgKHZkZXYtPm1pZ3JhdGlvbikgewor
ICAgICAgICBpbnQgaTsKKyAgICAgICAgcWVtdV9kZWxfdm1fY2hhbmdlX3N0YXRlX2hhbmRsZXIo
dmRldi0+bWlncmF0aW9uLT52bV9zdGF0ZSk7CisgICAgICAgIHVucmVnaXN0ZXJfc2F2ZXZtKE5V
TEwsIFRZUEVfVkZJT19QQ0ksIHZkZXYpOworICAgICAgICBmb3IgKGkgPSAwOyBpIDwgVkZJT19E
RVZTVEFURV9SRUdJT05fTlVNOyBpKyspIHsKKyAgICAgICAgICAgIHZmaW9fcmVnaW9uX2ZpbmFs
aXplKCZ2ZGV2LT5taWdyYXRpb24tPnJlZ2lvbltpXSk7CisgICAgICAgIH0KKyAgICAgICAgZ19m
cmVlKHZkZXYtPm1pZ3JhdGlvbik7CisgICAgICAgIHZkZXYtPm1pZ3JhdGlvbiA9IE5VTEw7Cisg
ICAgfSBlbHNlIGlmICh2ZGV2LT5taWdyYXRpb25fYmxvY2tlcikgeworICAgICAgICBtaWdyYXRl
X2RlbF9ibG9ja2VyKHZkZXYtPm1pZ3JhdGlvbl9ibG9ja2VyKTsKKyAgICAgICAgZXJyb3JfZnJl
ZSh2ZGV2LT5taWdyYXRpb25fYmxvY2tlcik7CisgICAgfQorfQpkaWZmIC0tZ2l0IGEvaHcvdmZp
by9wY2kuYyBiL2h3L3ZmaW8vcGNpLmMKaW5kZXggYzBjYjFlYy4uYjhlMDA2YiAxMDA2NDQKLS0t
IGEvaHcvdmZpby9wY2kuYworKysgYi9ody92ZmlvL3BjaS5jCkBAIC0zNyw3ICszNyw2IEBACiAK
ICNkZWZpbmUgTVNJWF9DQVBfTEVOR1RIIDEyCiAKLSNkZWZpbmUgVFlQRV9WRklPX1BDSSAidmZp
by1wY2kiCiAjZGVmaW5lIFBDSV9WRklPKG9iaikgICAgT0JKRUNUX0NIRUNLKFZGSU9QQ0lEZXZp
Y2UsIG9iaiwgVFlQRV9WRklPX1BDSSkKIAogc3RhdGljIHZvaWQgdmZpb19kaXNhYmxlX2ludGVy
cnVwdHMoVkZJT1BDSURldmljZSAqdmRldik7CmRpZmYgLS1naXQgYS9ody92ZmlvL3BjaS5oIGIv
aHcvdmZpby9wY2kuaAppbmRleCBiMWFlNGMwLi40YjdiMWJiIDEwMDY0NAotLS0gYS9ody92Zmlv
L3BjaS5oCisrKyBiL2h3L3ZmaW8vcGNpLmgKQEAgLTE5LDYgKzE5LDcgQEAKICNpbmNsdWRlICJx
ZW11L2V2ZW50X25vdGlmaWVyLmgiCiAjaW5jbHVkZSAicWVtdS9xdWV1ZS5oIgogI2luY2x1ZGUg
InFlbXUvdGltZXIuaCIKKyNpbmNsdWRlICJzeXNlbXUvc3lzZW11LmgiCiAKICNkZWZpbmUgUENJ
X0FOWV9JRCAofjApCiAKQEAgLTU2LDYgKzU3LDIxIEBAIHR5cGVkZWYgc3RydWN0IFZGSU9CQVIg
ewogICAgIFFMSVNUX0hFQUQoLCBWRklPUXVpcmspIHF1aXJrczsKIH0gVkZJT0JBUjsKIAorZW51
bSB7CisgICAgVkZJT19ERVZTVEFURV9SRUdJT05fQ1RMID0gMCwKKyAgICBWRklPX0RFVlNUQVRF
X1JFR0lPTl9EQVRBX0NPTkZJRywKKyAgICBWRklPX0RFVlNUQVRFX1JFR0lPTl9EQVRBX0RFVklD
RV9NRU1PUlksCisgICAgVkZJT19ERVZTVEFURV9SRUdJT05fREFUQV9CSVRNQVAsCisgICAgVkZJ
T19ERVZTVEFURV9SRUdJT05fTlVNLAorfTsKK3R5cGVkZWYgc3RydWN0IFZGSU9NaWdyYXRpb24g
eworICAgIFZGSU9SZWdpb24gcmVnaW9uW1ZGSU9fREVWU1RBVEVfUkVHSU9OX05VTV07CisgICAg
dWludDMyX3QgZGF0YV9jYXBzOworICAgIHVpbnQzMl90IGRldmljZV9zdGF0ZTsKKyAgICB1aW50
NjRfdCBkZXZjb25maWdfc2l6ZTsKKyAgICBWTUNoYW5nZVN0YXRlRW50cnkgKnZtX3N0YXRlOwor
fSBWRklPTWlncmF0aW9uOworCiB0eXBlZGVmIHN0cnVjdCBWRklPVkdBUmVnaW9uIHsKICAgICBN
ZW1vcnlSZWdpb24gbWVtOwogICAgIG9mZl90IG9mZnNldDsKQEAgLTEzMiw2ICsxNDgsOCBAQCB0
eXBlZGVmIHN0cnVjdCBWRklPUENJRGV2aWNlIHsKICAgICBWRklPQkFSIGJhcnNbUENJX05VTV9S
RUdJT05TIC0gMV07IC8qIE5vIFJPTSAqLwogICAgIFZGSU9WR0EgKnZnYTsgLyogMHhhMDAwMCwg
MHgzYjAsIDB4M2MwICovCiAgICAgdm9pZCAqaWdkX29wcmVnaW9uOworICAgIFZGSU9NaWdyYXRp
b24gKm1pZ3JhdGlvbjsKKyAgICBFcnJvciAqbWlncmF0aW9uX2Jsb2NrZXI7CiAgICAgUENJSG9z
dERldmljZUFkZHJlc3MgaG9zdDsKICAgICBFdmVudE5vdGlmaWVyIGVycl9ub3RpZmllcjsKICAg
ICBFdmVudE5vdGlmaWVyIHJlcV9ub3RpZmllcjsKQEAgLTE5OCw1ICsyMTYsMTAgQEAgaW50IHZm
aW9fcGNpX2lnZF9vcHJlZ2lvbl9pbml0KFZGSU9QQ0lEZXZpY2UgKnZkZXYsCiB2b2lkIHZmaW9f
ZGlzcGxheV9yZXNldChWRklPUENJRGV2aWNlICp2ZGV2KTsKIGludCB2ZmlvX2Rpc3BsYXlfcHJv
YmUoVkZJT1BDSURldmljZSAqdmRldiwgRXJyb3IgKiplcnJwKTsKIHZvaWQgdmZpb19kaXNwbGF5
X2ZpbmFsaXplKFZGSU9QQ0lEZXZpY2UgKnZkZXYpOwotCitib29sIHZmaW9fZGV2aWNlX2RhdGFf
Y2FwX3N5c3RlbV9tZW1vcnkoVkZJT1BDSURldmljZSAqdmRldik7Citib29sIHZmaW9fZGV2aWNl
X2RhdGFfY2FwX2RldmljZV9tZW1vcnkoVkZJT1BDSURldmljZSAqdmRldik7CitpbnQgdmZpb19z
ZXRfZGlydHlfcGFnZV9iaXRtYXAoVkZJT1BDSURldmljZSAqdmRldiwKKyAgICAgICAgIHVpbnQ2
NF90IHN0YXJ0X2FkZHIsIHVpbnQ2NF90IHBhZ2VfbnIpOworaW50IHZmaW9fbWlncmF0aW9uX2lu
aXQoVkZJT1BDSURldmljZSAqdmRldiwgRXJyb3IgKiplcnJwKTsKK3ZvaWQgdmZpb19taWdyYXRp
b25fZmluYWxpemUoVkZJT1BDSURldmljZSAqdmRldik7CiAjZW5kaWYgLyogSFdfVkZJT19WRklP
X1BDSV9IICovCmRpZmYgLS1naXQgYS9pbmNsdWRlL2h3L3ZmaW8vdmZpby1jb21tb24uaCBiL2lu
Y2x1ZGUvaHcvdmZpby92ZmlvLWNvbW1vbi5oCmluZGV4IDFiNDM0ZDAuLmVkNDM2MTMgMTAwNjQ0
Ci0tLSBhL2luY2x1ZGUvaHcvdmZpby92ZmlvLWNvbW1vbi5oCisrKyBiL2luY2x1ZGUvaHcvdmZp
by92ZmlvLWNvbW1vbi5oCkBAIC0zMiw2ICszMiw3IEBACiAjZW5kaWYKIAogI2RlZmluZSBWRklP
X01TR19QUkVGSVggInZmaW8gJXM6ICIKKyNkZWZpbmUgVFlQRV9WRklPX1BDSSAidmZpby1wY2ki
CiAKIGVudW0gewogICAgIFZGSU9fREVWSUNFX1RZUEVfUENJID0gMCwKLS0gCjIuNy40CgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwppbnRlbC1ndnQtZGV2
IG1haWxpbmcgbGlzdAppbnRlbC1ndnQtZGV2QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWd2dC1kZXY=
