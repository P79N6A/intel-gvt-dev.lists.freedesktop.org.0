Delivered-To: linux.kernel.mailinglists@gmail.com
Received: by 2002:a81:3684:0:0:0:0:0 with SMTP id d126csp3190356ywa;
        Tue, 19 Feb 2019 03:25:55 -0800 (PST)
X-Google-Smtp-Source: AHgI3IYHi9joz+N83oMPJQvy21hDZ44QzL037trTLeXC1MzqJ/RVt4QjLNRStJ/tXkqgx4ySO+P3
X-Received: by 2002:a65:63d3:: with SMTP id n19mr23737427pgv.179.1550575555533;
        Tue, 19 Feb 2019 03:25:55 -0800 (PST)
ARC-Seal: i=1; a=rsa-sha256; t=1550575555; cv=none;
        d=google.com; s=arc-20160816;
        b=JhAX8YL2F8szSi82RzvwzRRYm5lflipBnAY65690AAFUPOZnQ9dzdzbmORC58Me293
         COo1aYukOSbekIDc6SM3BJYN5rbSvEJ4+gz4No8L1kJ5V5XLBIJ3adU4fEy279ZW5JpP
         a1RpzbgASqI0qmCAO1Qmci10gCEThNUtSpkvQOsf49vV01l2D6WxWAMqlY6P0SLmtl1O
         K7buHsCZ2KJ6nUGpRpSA5YWbG7CCq7l2CurMCVCqsGSBC2+lDZWSBHgYcTBel+YNNoMn
         zzFKpuvSDbrZWrS4i/rVxCJybogzwnx4RFQ/DDrLanThmokCxiRiAA2JxHao+nM3BkUL
         s3vQ==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=sender:errors-to:content-transfer-encoding:cc:list-subscribe
         :list-help:list-post:list-archive:list-unsubscribe:list-id
         :precedence:user-agent:in-reply-to:content-disposition:mime-version
         :references:message-id:subject:to:from:date:delivered-to;
        bh=4srCg7WUzNcBlDR1kMW+25tteZfNQI6Urf7jRVDAI1s=;
        b=aZOcVSjqMaDxt3fUisN1+8cpuvR8SC91NDPCbAjScj3c7baM7eTeqyiz078ZghuZiv
         AzN3zRC8XeyLSfjTJyM9f4BdkmM8Lf/BO9eofVgjKCWTPqdXB7eDmfNR13bGZDaTHyKm
         J5rJPSBR2Imz9zbJXU95EBYIWzvA8q2Zr7RtqkYGZMMm9aBMCLjKyhdOvYXw1sMemsE/
         K8PUQHB2K5xGeFD0MK5Ws9UZiLXm/q8pp5PQWBE/BKBOPmWT2ux4m1bwgVShBU/tJNB2
         2a09YhgtF0YvqtgyuUgBsW3NwoPFWNEbAFpFRFD7lp6CzRnvFUVqqPGblshM2YwQF1CU
         H/SA==
ARC-Authentication-Results: i=1; mx.google.com;
       spf=pass (google.com: best guess record for domain of intel-gvt-dev-bounces@lists.freedesktop.org designates 131.252.210.177 as permitted sender) smtp.mailfrom=intel-gvt-dev-bounces@lists.freedesktop.org;
       dmarc=fail (p=NONE sp=NONE dis=NONE) header.from=redhat.com
Return-Path: <intel-gvt-dev-bounces@lists.freedesktop.org>
Received: from gabe.freedesktop.org (gabe.freedesktop.org. [131.252.210.177])
        by mx.google.com with ESMTPS id q19si2423630pgv.289.2019.02.19.03.25.54
        (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
        Tue, 19 Feb 2019 03:25:55 -0800 (PST)
Received-SPF: pass (google.com: best guess record for domain of intel-gvt-dev-bounces@lists.freedesktop.org designates 131.252.210.177 as permitted sender) client-ip=131.252.210.177;
Authentication-Results: mx.google.com;
       spf=pass (google.com: best guess record for domain of intel-gvt-dev-bounces@lists.freedesktop.org designates 131.252.210.177 as permitted sender) smtp.mailfrom=intel-gvt-dev-bounces@lists.freedesktop.org;
       dmarc=fail (p=NONE sp=NONE dis=NONE) header.from=redhat.com
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9FF8B8926E;
	Tue, 19 Feb 2019 11:25:54 +0000 (UTC)
X-Original-To: intel-gvt-dev@lists.freedesktop.org
Delivered-To: intel-gvt-dev@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8E5B78926E
 for <intel-gvt-dev@lists.freedesktop.org>;
 Tue, 19 Feb 2019 11:25:53 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx06.intmail.prod.int.phx2.redhat.com
 [10.5.11.16])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id D525DB749C;
 Tue, 19 Feb 2019 11:25:52 +0000 (UTC)
Received: from work-vm (unknown [10.36.118.35])
 by smtp.corp.redhat.com (Postfix) with ESMTPS id C6695171F6;
 Tue, 19 Feb 2019 11:25:45 +0000 (UTC)
Date: Tue, 19 Feb 2019 11:25:43 +0000
From: "Dr. David Alan Gilbert" <dgilbert@redhat.com>
To: Yan Zhao <yan.y.zhao@intel.com>
Subject: Re: [PATCH 5/5] vfio/migration: support device memory capability
Message-ID: <20190219112542.GB2941@work-vm>
References: <1550566254-3545-1-git-send-email-yan.y.zhao@intel.com>
 <1550566380-3788-1-git-send-email-yan.y.zhao@intel.com>
MIME-Version: 1.0
Content-Disposition: inline
In-Reply-To: <1550566380-3788-1-git-send-email-yan.y.zhao@intel.com>
User-Agent: Mutt/1.10.1 (2018-07-13)
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.16
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.30]); Tue, 19 Feb 2019 11:25:53 +0000 (UTC)
X-BeenThere: intel-gvt-dev@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: "Intel GVT \(Graphics Virtualization\) development list"
 <intel-gvt-dev.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gvt-dev>
List-Post: <mailto:intel-gvt-dev@lists.freedesktop.org>
List-Help: <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gvt-dev>, 
 <mailto:intel-gvt-dev-request@lists.freedesktop.org?subject=subscribe>
Cc: cjia@nvidia.com, kvm@vger.kernel.org, aik@ozlabs.ru,
 Zhengxiao.zx@alibaba-inc.com, shuangtai.tst@alibaba-inc.com,
 qemu-devel@nongnu.org, kwankhede@nvidia.com, eauger@redhat.com,
 yi.l.liu@intel.com, eskultet@redhat.com, ziye.yang@intel.com,
 mlevitsk@redhat.com, pasic@linux.ibm.com, arei.gonglei@huawei.com,
 felipe@nutanix.com, Ken.Xue@amd.com, kevin.tian@intel.com,
 alex.williamson@redhat.com, intel-gvt-dev@lists.freedesktop.org,
 changpeng.liu@intel.com, cohuck@redhat.com, zhi.a.wang@intel.com,
 jonathan.davies@nutanix.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gvt-dev-bounces@lists.freedesktop.org
Sender: "intel-gvt-dev" <intel-gvt-dev-bounces@lists.freedesktop.org>

KiBZYW4gWmhhbyAoeWFuLnkuemhhb0BpbnRlbC5jb20pIHdyb3RlOgo+IElmIGEgZGV2aWNlIGhh
cyBkZXZpY2UgbWVtb3J5IGNhcGFiaWxpdHksIHNhdmUvbG9hZCBkYXRhIGZyb20gZGV2aWNlIG1l
bW9yeQo+IGluIHByZS1jb3B5IGFuZCBzdG9wLWFuZC1jb3B5IHBoYXNlcy4KPiAKPiBMT0dHSU5H
IHN0YXRlIGlzIHNldCBmb3IgZGV2aWNlIG1lbW9yeSBmb3IgZGlydHkgcGFnZSBsb2dnaW5nOgo+
IGluIExPR0dJTkcgc3RhdGUsIGdldCBkZXZpY2UgbWVtb3J5IHJldHVybnMgd2hvbGUgZGV2aWNl
IG1lbW9yeSBzbmFwc2hvdDsKPiBvdXRzaWRlIExPR0dJTkcgc3RhdGUsIGdldCBkZXZpY2UgbWVt
b3J5IHJldHVybnMgZGlydHkgZGF0YSBzaW5jZSBsYXN0IGdldAo+IG9wZXJhdGlvbi4KPiAKPiBV
c3VhbGx5LCBkZXZpY2UgbWVtb3J5IGlzIHZlcnkgYmlnLCBxZW11IG5lZWRzIHRvIGNodW5rIGl0
IGludG8gc2V2ZXJhbAo+IHBpZWNlcyBlYWNoIHdpdGggc2l6ZSBvZiBkZXZpY2UgbWVtb3J5IHJl
Z2lvbi4KPiAKPiBTaWduZWQtb2ZmLWJ5OiBZYW4gWmhhbyA8eWFuLnkuemhhb0BpbnRlbC5jb20+
Cj4gU2lnbmVkLW9mZi1ieTogS2lydGkgV2Fua2hlZGUgPGt3YW5raGVkZUBudmlkaWEuY29tPgo+
IC0tLQo+ICBody92ZmlvL21pZ3JhdGlvbi5jIHwgMjM1ICsrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrLS0KPiAgaHcvdmZpby9wY2kuaCAgICAgICB8ICAg
MSArCj4gIDIgZmlsZXMgY2hhbmdlZCwgMjMxIGluc2VydGlvbnMoKyksIDUgZGVsZXRpb25zKC0p
Cj4gCj4gZGlmZiAtLWdpdCBhL2h3L3ZmaW8vbWlncmF0aW9uLmMgYi9ody92ZmlvL21pZ3JhdGlv
bi5jCj4gaW5kZXggMTZkNjM5NS4uZjFlOTMwOSAxMDA2NDQKPiAtLS0gYS9ody92ZmlvL21pZ3Jh
dGlvbi5jCj4gKysrIGIvaHcvdmZpby9taWdyYXRpb24uYwo+IEBAIC0yMDMsNiArMjAzLDIwMSBA
QCBzdGF0aWMgaW50IHZmaW9fbG9hZF9kYXRhX2RldmljZV9jb25maWcoVkZJT1BDSURldmljZSAq
dmRldiwKPiAgICAgIHJldHVybiAwOwo+ICB9Cj4gIAo+ICtzdGF0aWMgaW50IHZmaW9fZ2V0X2Rl
dmljZV9tZW1vcnlfc2l6ZShWRklPUENJRGV2aWNlICp2ZGV2KQo+ICt7Cj4gKyAgICBWRklPRGV2
aWNlICp2YmFzZWRldiA9ICZ2ZGV2LT52YmFzZWRldjsKPiArICAgIFZGSU9SZWdpb24gKnJlZ2lv
bl9jdGwgPQo+ICsgICAgICAgICZ2ZGV2LT5taWdyYXRpb24tPnJlZ2lvbltWRklPX0RFVlNUQVRF
X1JFR0lPTl9DVExdOwo+ICsgICAgdWludDY0X3QgbGVuOwo+ICsgICAgaW50IHN6Owo+ICsKPiAr
ICAgIHN6ID0gc2l6ZW9mKGxlbik7Cj4gKyAgICBpZiAocHJlYWQodmJhc2VkZXYtPmZkLCAmbGVu
LCBzeiwKPiArICAgICAgICAgICAgICAgIHJlZ2lvbl9jdGwtPmZkX29mZnNldCArCj4gKyAgICAg
ICAgICAgICAgICBvZmZzZXRvZihzdHJ1Y3QgdmZpb19kZXZpY2Vfc3RhdGVfY3RsLCBkZXZpY2Vf
bWVtb3J5LnNpemUpKQo+ICsgICAgICAgICAgICAhPSBzeikgewo+ICsgICAgICAgIGVycm9yX3Jl
cG9ydCgidmZpbzogRmFpbGVkIHRvIGdldCBsZW5ndGggb2YgZGV2aWNlIG1lbW9yeSIpOwo+ICsg
ICAgICAgIHJldHVybiAtMTsKPiArICAgIH0KPiArICAgIHZkZXYtPm1pZ3JhdGlvbi0+ZGV2bWVt
X3NpemUgPSBsZW47Cj4gKyAgICByZXR1cm4gMDsKPiArfQo+ICsKPiArc3RhdGljIGludCB2Zmlv
X3NldF9kZXZpY2VfbWVtb3J5X3NpemUoVkZJT1BDSURldmljZSAqdmRldiwgdWludDY0X3Qgc2l6
ZSkKPiArewo+ICsgICAgVkZJT0RldmljZSAqdmJhc2VkZXYgPSAmdmRldi0+dmJhc2VkZXY7Cj4g
KyAgICBWRklPUmVnaW9uICpyZWdpb25fY3RsID0KPiArICAgICAgICAmdmRldi0+bWlncmF0aW9u
LT5yZWdpb25bVkZJT19ERVZTVEFURV9SRUdJT05fQ1RMXTsKPiArICAgIGludCBzejsKPiArCj4g
KyAgICBzeiA9IHNpemVvZihzaXplKTsKPiArICAgIGlmIChwd3JpdGUodmJhc2VkZXYtPmZkLCAm
c2l6ZSwgc3osCj4gKyAgICAgICAgICAgICAgICByZWdpb25fY3RsLT5mZF9vZmZzZXQgKwo+ICsg
ICAgICAgICAgICAgICAgb2Zmc2V0b2Yoc3RydWN0IHZmaW9fZGV2aWNlX3N0YXRlX2N0bCwgZGV2
aWNlX21lbW9yeS5zaXplKSkKPiArICAgICAgICAgICAgIT0gc3opIHsKPiArICAgICAgICBlcnJv
cl9yZXBvcnQoInZmaW86IEZhaWxlZCB0byBzZXQgbGVuZ3RoIG9mIGRldmljZSBjb21lbW9yeSIp
Owo+ICsgICAgICAgIHJldHVybiAtMTsKPiArICAgIH0KPiArICAgIHZkZXYtPm1pZ3JhdGlvbi0+
ZGV2bWVtX3NpemUgPSBzaXplOwo+ICsgICAgcmV0dXJuIDA7Cj4gK30KPiArCj4gK3N0YXRpYwo+
ICtpbnQgdmZpb19zYXZlX2RhdGFfZGV2aWNlX21lbW9yeV9jaHVuayhWRklPUENJRGV2aWNlICp2
ZGV2LCBRRU1VRmlsZSAqZiwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
dWludDY0X3QgcG9zLCB1aW50NjRfdCBsZW4pCj4gK3sKPiArICAgIFZGSU9EZXZpY2UgKnZiYXNl
ZGV2ID0gJnZkZXYtPnZiYXNlZGV2Owo+ICsgICAgVkZJT1JlZ2lvbiAqcmVnaW9uX2N0bCA9Cj4g
KyAgICAgICAgJnZkZXYtPm1pZ3JhdGlvbi0+cmVnaW9uW1ZGSU9fREVWU1RBVEVfUkVHSU9OX0NU
TF07Cj4gKyAgICBWRklPUmVnaW9uICpyZWdpb25fZGV2bWVtID0KPiArICAgICAgICAmdmRldi0+
bWlncmF0aW9uLT5yZWdpb25bVkZJT19ERVZTVEFURV9SRUdJT05fREFUQV9ERVZJQ0VfTUVNT1JZ
XTsKPiArICAgIHZvaWQgKmRlc3Q7Cj4gKyAgICB1aW50MzJfdCBzejsKPiArICAgIHVpbnQ4X3Qg
KmJ1ZiA9IE5VTEw7Cj4gKyAgICB1aW50MzJfdCBhY3Rpb24gPSBWRklPX0RFVklDRV9EQVRBX0FD
VElPTl9HRVRfQlVGRkVSOwo+ICsKPiArICAgIGlmIChsZW4gPiByZWdpb25fZGV2bWVtLT5zaXpl
KSB7Cj4gKyAgICAgICAgcmV0dXJuIC0xOwo+ICsgICAgfQo+ICsKPiArICAgIHN6ID0gc2l6ZW9m
KHBvcyk7Cj4gKyAgICBpZiAocHdyaXRlKHZiYXNlZGV2LT5mZCwgJnBvcywgc3osCj4gKyAgICAg
ICAgICAgICAgICByZWdpb25fY3RsLT5mZF9vZmZzZXQgKwo+ICsgICAgICAgICAgICAgICAgb2Zm
c2V0b2Yoc3RydWN0IHZmaW9fZGV2aWNlX3N0YXRlX2N0bCwgZGV2aWNlX21lbW9yeS5wb3MpKQo+
ICsgICAgICAgICAgICAhPSBzeikgewo+ICsgICAgICAgIGVycm9yX3JlcG9ydCgidmZpbzogRmFp
bGVkIHRvIHNldCBzYXZlIGJ1ZmZlciBwb3MiKTsKPiArICAgICAgICByZXR1cm4gLTE7Cj4gKyAg
ICB9Cj4gKyAgICBzeiA9IHNpemVvZihhY3Rpb24pOwo+ICsgICAgaWYgKHB3cml0ZSh2YmFzZWRl
di0+ZmQsICZhY3Rpb24sIHN6LAo+ICsgICAgICAgICAgICAgICAgcmVnaW9uX2N0bC0+ZmRfb2Zm
c2V0ICsKPiArICAgICAgICAgICAgICAgIG9mZnNldG9mKHN0cnVjdCB2ZmlvX2RldmljZV9zdGF0
ZV9jdGwsIGRldmljZV9tZW1vcnkuYWN0aW9uKSkKPiArICAgICAgICAgICAgIT0gc3opIHsKPiAr
ICAgICAgICBlcnJvcl9yZXBvcnQoInZmaW86IEZhaWxlZCB0byBzZXQgc2F2ZSBidWZmZXIgYWN0
aW9uIik7Cj4gKyAgICAgICAgcmV0dXJuIC0xOwo+ICsgICAgfQo+ICsKPiArICAgIGlmICghdmZp
b19kZXZpY2Vfc3RhdGVfcmVnaW9uX21tYXBlZChyZWdpb25fZGV2bWVtKSkgewo+ICsgICAgICAg
IGJ1ZiA9IGdfbWFsbG9jKGxlbik7Cj4gKyAgICAgICAgaWYgKGJ1ZiA9PSBOVUxMKSB7Cj4gKyAg
ICAgICAgICAgIGVycm9yX3JlcG9ydCgidmZpbzogRmFpbGVkIHRvIGFsbG9jYXRlIG1lbW9yeSBm
b3IgbWlncmF0ZSIpOwo+ICsgICAgICAgICAgICByZXR1cm4gLTE7Cj4gKyAgICAgICAgfQo+ICsg
ICAgICAgIGlmIChwcmVhZCh2YmFzZWRldi0+ZmQsIGJ1ZiwgbGVuLCByZWdpb25fZGV2bWVtLT5m
ZF9vZmZzZXQpICE9IGxlbikgewo+ICsgICAgICAgICAgICBlcnJvcl9yZXBvcnQoInZmaW86IGVy
cm9yIGxvYWQgZGV2aWNlIG1lbW9yeSBidWZmZXIiKTsKClRoYXQncyBmb3Jnb3R0ZW4gdG8gZ19m
cmVlKGJ1ZikKCj4gKyAgICAgICAgICAgIHJldHVybiAtMTsKPiArICAgICAgICB9Cj4gKyAgICAg
ICAgcWVtdV9wdXRfYmU2NChmLCBsZW4pOwo+ICsgICAgICAgIHFlbXVfcHV0X2JlNjQoZiwgcG9z
KTsKPiArICAgICAgICBxZW11X3B1dF9idWZmZXIoZiwgYnVmLCBsZW4pOwo+ICsgICAgICAgIGdf
ZnJlZShidWYpOwo+ICsgICAgfSBlbHNlIHsKPiArICAgICAgICBkZXN0ID0gcmVnaW9uX2Rldm1l
bS0+bW1hcHNbMF0ubW1hcDsKPiArICAgICAgICBxZW11X3B1dF9iZTY0KGYsIGxlbik7Cj4gKyAg
ICAgICAgcWVtdV9wdXRfYmU2NChmLCBwb3MpOwo+ICsgICAgICAgIHFlbXVfcHV0X2J1ZmZlcihm
LCBkZXN0LCBsZW4pOwo+ICsgICAgfQo+ICsgICAgcmV0dXJuIDA7Cj4gK30KPiArCj4gK3N0YXRp
YyBpbnQgdmZpb19zYXZlX2RhdGFfZGV2aWNlX21lbW9yeShWRklPUENJRGV2aWNlICp2ZGV2LCBR
RU1VRmlsZSAqZikKPiArewo+ICsgICAgVkZJT1JlZ2lvbiAqcmVnaW9uX2Rldm1lbSA9Cj4gKyAg
ICAgICAgJnZkZXYtPm1pZ3JhdGlvbi0+cmVnaW9uW1ZGSU9fREVWU1RBVEVfUkVHSU9OX0RBVEFf
REVWSUNFX01FTU9SWV07Cj4gKyAgICB1aW50NjRfdCB0b3RhbF9sZW4gPSB2ZGV2LT5taWdyYXRp
b24tPmRldm1lbV9zaXplOwo+ICsgICAgdWludDY0X3QgcG9zID0gMDsKPiArCj4gKyAgICBxZW11
X3B1dF9iZTY0KGYsIHRvdGFsX2xlbik7Cj4gKyAgICB3aGlsZSAocG9zIDwgdG90YWxfbGVuKSB7
Cj4gKyAgICAgICAgdWludDY0X3QgbGVuID0gcmVnaW9uX2Rldm1lbS0+c2l6ZTsKPiArCj4gKyAg
ICAgICAgaWYgKHBvcyArIGxlbiA+PSB0b3RhbF9sZW4pIHsKPiArICAgICAgICAgICAgbGVuID0g
dG90YWxfbGVuIC0gcG9zOwo+ICsgICAgICAgIH0KPiArICAgICAgICBpZiAodmZpb19zYXZlX2Rh
dGFfZGV2aWNlX21lbW9yeV9jaHVuayh2ZGV2LCBmLCBwb3MsIGxlbikpIHsKPiArICAgICAgICAg
ICAgcmV0dXJuIC0xOwo+ICsgICAgICAgIH0KPiArICAgIH0KPiArCj4gKyAgICByZXR1cm4gMDsK
PiArfQo+ICsKPiArc3RhdGljCj4gK2ludCB2ZmlvX2xvYWRfZGF0YV9kZXZpY2VfbWVtb3J5X2No
dW5rKFZGSU9QQ0lEZXZpY2UgKnZkZXYsIFFFTVVGaWxlICpmLAo+ICsgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHVpbnQ2NF90IHBvcywgdWludDY0X3QgbGVuKQo+ICt7Cj4gKyAgICBW
RklPRGV2aWNlICp2YmFzZWRldiA9ICZ2ZGV2LT52YmFzZWRldjsKPiArICAgIFZGSU9SZWdpb24g
KnJlZ2lvbl9jdGwgPQo+ICsgICAgICAgICZ2ZGV2LT5taWdyYXRpb24tPnJlZ2lvbltWRklPX0RF
VlNUQVRFX1JFR0lPTl9DVExdOwo+ICsgICAgVkZJT1JlZ2lvbiAqcmVnaW9uX2Rldm1lbSA9Cj4g
KyAgICAgICAgJnZkZXYtPm1pZ3JhdGlvbi0+cmVnaW9uW1ZGSU9fREVWU1RBVEVfUkVHSU9OX0RB
VEFfREVWSUNFX01FTU9SWV07Cj4gKwo+ICsgICAgdm9pZCAqZGVzdDsKPiArICAgIHVpbnQzMl90
IHN6Owo+ICsgICAgdWludDhfdCAqYnVmID0gTlVMTDsKPiArICAgIHVpbnQzMl90IGFjdGlvbiA9
IFZGSU9fREVWSUNFX0RBVEFfQUNUSU9OX1NFVF9CVUZGRVI7Cj4gKwo+ICsgICAgaWYgKGxlbiA+
IHJlZ2lvbl9kZXZtZW0tPnNpemUpIHsKPiArICAgICAgICByZXR1cm4gLTE7Cj4gKyAgICB9Cj4g
Kwo+ICsgICAgc3ogPSBzaXplb2YocG9zKTsKPiArICAgIGlmIChwd3JpdGUodmJhc2VkZXYtPmZk
LCAmcG9zLCBzeiwKPiArICAgICAgICAgICAgICAgIHJlZ2lvbl9jdGwtPmZkX29mZnNldCArCj4g
KyAgICAgICAgICAgICAgICBvZmZzZXRvZihzdHJ1Y3QgdmZpb19kZXZpY2Vfc3RhdGVfY3RsLCBk
ZXZpY2VfbWVtb3J5LnBvcykpCj4gKyAgICAgICAgICAgICE9IHN6KSB7Cj4gKyAgICAgICAgZXJy
b3JfcmVwb3J0KCJ2ZmlvOiBGYWlsZWQgdG8gc2V0IGRldmljZSBtZW1vcnkgYnVmZmVyIHBvcyIp
Owo+ICsgICAgICAgIHJldHVybiAtMTsKPiArICAgIH0KPiArICAgIGlmICghdmZpb19kZXZpY2Vf
c3RhdGVfcmVnaW9uX21tYXBlZChyZWdpb25fZGV2bWVtKSkgewo+ICsgICAgICAgIGJ1ZiA9IGdf
bWFsbG9jKGxlbik7Cj4gKyAgICAgICAgaWYgKGJ1ZiA9PSBOVUxMKSB7Cj4gKyAgICAgICAgICAg
IGVycm9yX3JlcG9ydCgidmZpbzogRmFpbGVkIHRvIGFsbG9jYXRlIG1lbW9yeSBmb3IgbWlncmF0
ZSIpOwo+ICsgICAgICAgICAgICByZXR1cm4gLTE7Cj4gKyAgICAgICAgfQo+ICsgICAgICAgIHFl
bXVfZ2V0X2J1ZmZlcihmLCBidWYsIGxlbik7Cj4gKyAgICAgICAgaWYgKHB3cml0ZSh2YmFzZWRl
di0+ZmQsIGJ1ZiwgbGVuLAo+ICsgICAgICAgICAgICAgICAgICAgIHJlZ2lvbl9kZXZtZW0tPmZk
X29mZnNldCkgIT0gbGVuKSB7Cj4gKyAgICAgICAgICAgIGVycm9yX3JlcG9ydCgidmZpbzogRmFp
bGVkIHRvIGxvYWQgZGV2aWUgbWVtb3J5IGJ1ZmZlciIpOwoKQWdhaW4sIGZhaWxlZCB0byBmcmVl
IGJ1ZgoKPiArICAgICAgICAgICAgcmV0dXJuIC0xOwo+ICsgICAgICAgIH0KPiArICAgICAgICBn
X2ZyZWUoYnVmKTsKPiArICAgIH0gZWxzZSB7Cj4gKyAgICAgICAgZGVzdCA9IHJlZ2lvbl9kZXZt
ZW0tPm1tYXBzWzBdLm1tYXA7Cj4gKyAgICAgICAgcWVtdV9nZXRfYnVmZmVyKGYsIGRlc3QsIGxl
bik7Cj4gKyAgICB9CgpZb3UgbWlnaHQgd2FudCB0byB1c2UgcWVtdV9maWxlX2dldF9lcnJvcihm
KSAgYmVmb3JlIHdyaXRpbmcgdGhlIGRhdGEKdG8gdGhlIGRldmljZSwgdG8gY2hlY2sgZm9yIHRo
ZSBjYXNlIG9mIGEgcmVhZCBlcnJvciBvbiB0aGUgbWlncmF0aW9uCnN0cmVhbSB0aGF0IGhhcHBl
bmVkIHNvbWV3aGVyZSBpbiB0aGUgcGV2aW91cyBxZW11X2dldCdzCgo+ICsgICAgc3ogPSBzaXpl
b2YoYWN0aW9uKTsKPiArICAgIGlmIChwd3JpdGUodmJhc2VkZXYtPmZkLCAmYWN0aW9uLCBzeiwK
PiArICAgICAgICAgICAgICAgIHJlZ2lvbl9jdGwtPmZkX29mZnNldCArCj4gKyAgICAgICAgICAg
ICAgICBvZmZzZXRvZihzdHJ1Y3QgdmZpb19kZXZpY2Vfc3RhdGVfY3RsLCBkZXZpY2VfbWVtb3J5
LmFjdGlvbikpCj4gKyAgICAgICAgICAgICE9IHN6KSB7Cj4gKyAgICAgICAgZXJyb3JfcmVwb3J0
KCJ2ZmlvOiBGYWlsZWQgdG8gc2V0IGxvYWQgZGV2aWNlIG1lbW9yeSBidWZmZXIgYWN0aW9uIik7
Cj4gKyAgICAgICAgcmV0dXJuIC0xOwo+ICsgICAgfQo+ICsKPiArICAgIHJldHVybiAwOwo+ICsK
PiArfQo+ICsKPiArc3RhdGljIGludCB2ZmlvX2xvYWRfZGF0YV9kZXZpY2VfbWVtb3J5KFZGSU9Q
Q0lEZXZpY2UgKnZkZXYsCj4gKyAgICAgICAgICAgICAgICAgICAgICAgIFFFTVVGaWxlICpmLCB1
aW50NjRfdCB0b3RhbF9sZW4pCj4gK3sKPiArICAgIHVpbnQ2NF90IHBvcyA9IDAsIGxlbiA9IDA7
Cj4gKwo+ICsgICAgdmZpb19zZXRfZGV2aWNlX21lbW9yeV9zaXplKHZkZXYsIHRvdGFsX2xlbik7
Cj4gKwo+ICsgICAgd2hpbGUgKHBvcyArIGxlbiA8IHRvdGFsX2xlbikgewo+ICsgICAgICAgIGxl
biA9IHFlbXVfZ2V0X2JlNjQoZik7Cj4gKyAgICAgICAgcG9zID0gcWVtdV9nZXRfYmU2NChmKTsK
ClBsZWFzZSBjaGVjayBsZW4vcG9zIC0gYWx3YXlzIGFzc3VtZSB0aGF0IHRoZSBtaWdyYXRpb24g
c3RyZWFtIGNvdWxkCmJlIChtYWxpY2lvdXNseSBvciBhY2NpZGVudGFsbHkpIGNvcnJ1cHQuCgo+
ICsgICAgICAgIHZmaW9fbG9hZF9kYXRhX2RldmljZV9tZW1vcnlfY2h1bmsodmRldiwgZiwgcG9z
LCBsZW4pOwo+ICsgICAgfQo+ICsKPiArICAgIHJldHVybiAwOwo+ICt9Cj4gKwo+ICsKPiAgc3Rh
dGljIGludCB2ZmlvX3NldF9kaXJ0eV9wYWdlX2JpdG1hcF9jaHVuayhWRklPUENJRGV2aWNlICp2
ZGV2LAo+ICAgICAgICAgIHVpbnQ2NF90IHN0YXJ0X2FkZHIsIHVpbnQ2NF90IHBhZ2VfbnIpCj4g
IHsKPiBAQCAtMzc3LDYgKzU3MiwxMCBAQCBzdGF0aWMgdm9pZCB2ZmlvX3NhdmVfbGl2ZV9wZW5k
aW5nKFFFTVVGaWxlICpmLCB2b2lkICpvcGFxdWUsCj4gICAgICAgICAgcmV0dXJuOwo+ICAgICAg
fQo+ICAKPiArICAgIC8qIGdldCBkaXJ0eSBkYXRhIHNpemUgb2YgZGV2aWNlIG1lbW9yeSAqLwo+
ICsgICAgdmZpb19nZXRfZGV2aWNlX21lbW9yeV9zaXplKHZkZXYpOwo+ICsKPiArICAgICpyZXNf
cHJlY29weV9vbmx5ICs9IHZkZXYtPm1pZ3JhdGlvbi0+ZGV2bWVtX3NpemU7Cj4gICAgICByZXR1
cm47Cj4gIH0KPiAgCj4gQEAgLTM4OCw3ICs1ODcsOSBAQCBzdGF0aWMgaW50IHZmaW9fc2F2ZV9p
dGVyYXRlKFFFTVVGaWxlICpmLCB2b2lkICpvcGFxdWUpCj4gICAgICAgICAgcmV0dXJuIDA7Cj4g
ICAgICB9Cj4gIAo+IC0gICAgcmV0dXJuIDA7Cj4gKyAgICBxZW11X3B1dF9ieXRlKGYsIFZGSU9f
U0FWRV9GTEFHX0RFVk1FTU9SWSk7Cj4gKyAgICAvKiBnZXQgZGlydHkgZGF0YSBvZiBkZXZpY2Ug
bWVtb3J5ICovCj4gKyAgICByZXR1cm4gdmZpb19zYXZlX2RhdGFfZGV2aWNlX21lbW9yeSh2ZGV2
LCBmKTsKPiAgfQo+ICAKPiAgc3RhdGljIHZvaWQgdmZpb19wY2lfbG9hZF9jb25maWcoVkZJT1BD
SURldmljZSAqdmRldiwgUUVNVUZpbGUgKmYpCj4gQEAgLTQ1OCw2ICs2NTksMTAgQEAgc3RhdGlj
IGludCB2ZmlvX2xvYWRfc3RhdGUoUUVNVUZpbGUgKmYsIHZvaWQgKm9wYXF1ZSwgaW50IHZlcnNp
b25faWQpCj4gICAgICAgICAgICAgIGxlbiA9IHFlbXVfZ2V0X2JlNjQoZik7Cj4gICAgICAgICAg
ICAgIHZmaW9fbG9hZF9kYXRhX2RldmljZV9jb25maWcodmRldiwgZiwgbGVuKTsKPiAgICAgICAg
ICAgICAgYnJlYWs7Cj4gKyAgICAgICAgY2FzZSBWRklPX1NBVkVfRkxBR19ERVZNRU1PUlk6Cj4g
KyAgICAgICAgICAgIGxlbiA9IHFlbXVfZ2V0X2JlNjQoZik7Cj4gKyAgICAgICAgICAgIHZmaW9f
bG9hZF9kYXRhX2RldmljZV9tZW1vcnkodmRldiwgZiwgbGVuKTsKPiArICAgICAgICAgICAgYnJl
YWs7Cj4gICAgICAgICAgZGVmYXVsdDoKPiAgICAgICAgICAgICAgcmV0ID0gLUVJTlZBTDsKPiAg
ICAgICAgICB9Cj4gQEAgLTUwMyw2ICs3MDgsMTMgQEAgc3RhdGljIGludCB2ZmlvX3NhdmVfY29t
cGxldGVfcHJlY29weShRRU1VRmlsZSAqZiwgdm9pZCAqb3BhcXVlKQo+ICAgICAgVkZJT1BDSURl
dmljZSAqdmRldiA9IG9wYXF1ZTsKPiAgICAgIGludCByYyA9IDA7Cj4gIAo+ICsgICAgaWYgKHZm
aW9fZGV2aWNlX2RhdGFfY2FwX2RldmljZV9tZW1vcnkodmRldikpIHsKPiArICAgICAgICBxZW11
X3B1dF9ieXRlKGYsIFZGSU9fU0FWRV9GTEFHX0RFVk1FTU9SWSB8IFZGSU9fU0FWRV9GTEFHX0NP
TlRJTlVFKTsKPiArICAgICAgICAvKiBnZXQgZGlydHkgZGF0YSBvZiBkZXZpY2UgbWVtb3J5ICov
Cj4gKyAgICAgICAgdmZpb19nZXRfZGV2aWNlX21lbW9yeV9zaXplKHZkZXYpOwo+ICsgICAgICAg
IHJjID0gdmZpb19zYXZlX2RhdGFfZGV2aWNlX21lbW9yeSh2ZGV2LCBmKTsKPiArICAgIH0KPiAr
Cj4gICAgICBxZW11X3B1dF9ieXRlKGYsIFZGSU9fU0FWRV9GTEFHX1BDSSB8IFZGSU9fU0FWRV9G
TEFHX0NPTlRJTlVFKTsKPiAgICAgIHZmaW9fcGNpX3NhdmVfY29uZmlnKHZkZXYsIGYpOwo+ICAK
PiBAQCAtNTE1LDEyICs3MjcsMjIgQEAgc3RhdGljIGludCB2ZmlvX3NhdmVfY29tcGxldGVfcHJl
Y29weShRRU1VRmlsZSAqZiwgdm9pZCAqb3BhcXVlKQo+ICAKPiAgc3RhdGljIGludCB2ZmlvX3Nh
dmVfc2V0dXAoUUVNVUZpbGUgKmYsIHZvaWQgKm9wYXF1ZSkKPiAgewo+ICsgICAgaW50IHJjID0g
MDsKPiAgICAgIFZGSU9QQ0lEZXZpY2UgKnZkZXYgPSBvcGFxdWU7Cj4gLSAgICBxZW11X3B1dF9i
eXRlKGYsIFZGSU9fU0FWRV9GTEFHX1NFVFVQKTsKPiArCj4gKyAgICBpZiAodmZpb19kZXZpY2Vf
ZGF0YV9jYXBfZGV2aWNlX21lbW9yeSh2ZGV2KSkgewo+ICsgICAgICAgIHFlbXVfcHV0X2J5dGUo
ZiwgVkZJT19TQVZFX0ZMQUdfU0VUVVAgfCBWRklPX1NBVkVfRkxBR19DT05USU5VRSk7Cj4gKyAg
ICAgICAgcWVtdV9wdXRfYnl0ZShmLCBWRklPX1NBVkVfRkxBR19ERVZNRU1PUlkpOwo+ICsgICAg
ICAgIC8qIGdldCB3aG9sZSBzbmFwc2hvdCBvZiBkZXZpY2UgbWVtb3J5ICovCj4gKyAgICAgICAg
dmZpb19nZXRfZGV2aWNlX21lbW9yeV9zaXplKHZkZXYpOwo+ICsgICAgICAgIHJjID0gdmZpb19z
YXZlX2RhdGFfZGV2aWNlX21lbW9yeSh2ZGV2LCBmKTsKPiArICAgIH0gZWxzZSB7Cj4gKyAgICAg
ICAgcWVtdV9wdXRfYnl0ZShmLCBWRklPX1NBVkVfRkxBR19TRVRVUCk7Cj4gKyAgICB9Cj4gIAo+
ICAgICAgdmZpb19zZXRfZGV2aWNlX3N0YXRlKHZkZXYsIFZGSU9fREVWSUNFX1NUQVRFX1JVTk5J
TkcgfAo+ICAgICAgICAgICAgICBWRklPX0RFVklDRV9TVEFURV9MT0dHSU5HKTsKPiAtICAgIHJl
dHVybiAwOwo+ICsgICAgcmV0dXJuIHJjOwo+ICB9Cj4gIAo+ICBzdGF0aWMgaW50IHZmaW9fbG9h
ZF9zZXR1cChRRU1VRmlsZSAqZiwgdm9pZCAqb3BhcXVlKQo+IEBAIC01NzYsOCArNzk4LDExIEBA
IGludCB2ZmlvX21pZ3JhdGlvbl9pbml0KFZGSU9QQ0lEZXZpY2UgKnZkZXYsIEVycm9yICoqZXJy
cCkKPiAgICAgICAgICBnb3RvIGVycm9yOwo+ICAgICAgfQo+ICAKPiAtICAgIGlmICh2ZmlvX2Rl
dmljZV9kYXRhX2NhcF9kZXZpY2VfbWVtb3J5KHZkZXYpKSB7Cj4gLSAgICAgICAgZXJyb3JfcmVw
b3J0KCJObyBzdXBwcG9ydCBvZiBkYXRhIGNhcCBkZXZpY2UgbWVtb3J5IFlldCIpOwo+ICsgICAg
aWYgKHZmaW9fZGV2aWNlX2RhdGFfY2FwX2RldmljZV9tZW1vcnkodmRldikgJiYKPiArICAgICAg
ICAgICAgdmZpb19kZXZpY2Vfc3RhdGVfcmVnaW9uX3NldHVwKHZkZXYsCj4gKyAgICAgICAgICAg
ICAgJnZkZXYtPm1pZ3JhdGlvbi0+cmVnaW9uW1ZGSU9fREVWU1RBVEVfUkVHSU9OX0RBVEFfREVW
SUNFX01FTU9SWV0sCj4gKyAgICAgICAgICAgICAgVkZJT19SRUdJT05fU1VCVFlQRV9ERVZJQ0Vf
U1RBVEVfREFUQV9NRU1PUlksCj4gKyAgICAgICAgICAgICAgImRldmljZS1zdGF0ZS1kYXRhLWRl
dmljZS1tZW1vcnkiKSkgewo+ICAgICAgICAgIGdvdG8gZXJyb3I7Cj4gICAgICB9Cj4gIAo+IGRp
ZmYgLS1naXQgYS9ody92ZmlvL3BjaS5oIGIvaHcvdmZpby9wY2kuaAo+IGluZGV4IDRiN2IxYmIu
LmEyY2M2NGIgMTAwNjQ0Cj4gLS0tIGEvaHcvdmZpby9wY2kuaAo+ICsrKyBiL2h3L3ZmaW8vcGNp
LmgKPiBAQCAtNjksNiArNjksNyBAQCB0eXBlZGVmIHN0cnVjdCBWRklPTWlncmF0aW9uIHsKPiAg
ICAgIHVpbnQzMl90IGRhdGFfY2FwczsKPiAgICAgIHVpbnQzMl90IGRldmljZV9zdGF0ZTsKPiAg
ICAgIHVpbnQ2NF90IGRldmNvbmZpZ19zaXplOwo+ICsgICAgdWludDY0X3QgZGV2bWVtX3NpemU7
Cj4gICAgICBWTUNoYW5nZVN0YXRlRW50cnkgKnZtX3N0YXRlOwo+ICB9IFZGSU9NaWdyYXRpb247
Cj4gIAo+IC0tIAo+IDIuNy40Cj4gCi0tCkRyLiBEYXZpZCBBbGFuIEdpbGJlcnQgLyBkZ2lsYmVy
dEByZWRoYXQuY29tIC8gTWFuY2hlc3RlciwgVUsKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KaW50ZWwtZ3Z0LWRldiBtYWlsaW5nIGxpc3QKaW50ZWwtZ3Z0
LWRldkBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9pbnRlbC1ndnQtZGV2
